{% extends "admin/base_site_print.html" %}
{% load i18n static %}

{% block title %}{% trans "نموذج تسليم سيارة" %} - {{ report.car.model_name }} {{ report.car.year }}{% endblock %}

{% block extrahead %}
<style>
    @media print {
        @page {
            size: A4 portrait;
            margin: 1cm;
        }
        
        body {
            font-family: 'Tajawal', 'Cairo', sans-serif;
            line-height: 1.5;
            color: #000;
            background: #fff;
            margin: 0;
            padding: 0;
        }
        
        .print-container {
            width: 100%;
            max-width: 21cm;
            margin: 0 auto;
            background: #fff;
            padding: 0;
        }
        
        .header-section {
            text-align: center;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .car-info-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        table.car-details {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        
        table.car-details th, 
        table.car-details td {
            border: 1px solid #ddd;
            padding: 5px 8px;
            text-align: right;
        }
        
        table.car-details th {
            background-color: #f8f9fa;
            font-weight: 600;
            width: 40%;
        }
        
        .car-images {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto auto;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .car-top-view {
            grid-column: 1 / -1;
            text-align: center;
        }
        
        .car-image {
            text-align: center;
        }
        
        .car-image img {
            max-width: 100%;
            height: auto;
        }
        
        .terms-section {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 0.9em;
            background-color: #f9f9f9;
        }
        
        .signatures {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        
        .signature-box {
            border-top: 1px solid #ddd;
            padding-top: 5px;
            text-align: center;
            font-size: 0.85em;
        }
        
        .page-break {
            page-break-after: always;
        }

        .inspection-item-normal {
            color: #28a745;
        }
        
        .inspection-item-damaged {
            color: #dc3545;
        }
        
        .inspection-item-warning {
            color: #ffc107;
        }
        
        .btn, .navbar, footer, .no-print {
            display: none !important;
        }

        .car-views-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    }

    /* Non-print styles */
    body {
        background-color: #f4f6f9;
        font-family: 'Tajawal', 'Cairo', sans-serif;
    }
    
    .print-container {
        width: 100%;
        max-width: 21cm;
        margin: 20px auto;
        background: #fff;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        border-radius: 5px;
    }
    
    .header-section {
        text-align: center;
        border-bottom: 1px solid #ddd;
        padding-bottom: 15px;
        margin-bottom: 20px;
    }
    
    .car-info-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    table.car-details {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }
    
    table.car-details th, 
    table.car-details td {
        border: 1px solid #ddd;
        padding: 8px 10px;
        text-align: right;
    }
    
    table.car-details th {
        background-color: #f8f9fa;
        font-weight: 600;
        width: 40%;
    }
    
    .car-images {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: auto auto auto;
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .car-top-view {
        grid-column: 1 / -1;
        text-align: center;
    }
    
    .car-image {
        text-align: center;
    }
    
    .car-image img {
        max-width: 100%;
        height: auto;
        border: 1px solid #ddd;
    }
    
    .terms-section {
        border: 1px solid #ddd;
        padding: 15px;
        margin-bottom: 20px;
        font-size: 0.9em;
        background-color: #f9f9f9;
        border-radius: 5px;
    }
    
    .signatures {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        gap: 15px;
        margin-top: 30px;
    }
    
    .signature-box {
        border-top: 1px solid #ddd;
        padding-top: 10px;
        text-align: center;
        font-size: 0.9em;
    }
    
    .inspection-item-normal {
        color: #28a745;
    }
    
    .inspection-item-damaged {
        color: #dc3545;
    }
    
    .inspection-item-warning {
        color: #ffc107;
    }

    .print-button {
        display: block;
        margin: 20px auto;
        padding: 10px 15px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1em;
    }

    .car-views-container {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .car-image img {
        max-width: 90%;
        margin: 0 auto;
    }
</style>
{% endblock %}

{% block content %}
<div class="print-container">
    <div class="header-section">
        <h2>نموذج تسليم سيارة</h2>
        <p>
            يحتوي هذا النموذج على معلومات حالة السيارة عند تسليمها للعميل، ويتضمن تفاصيل السيارة، وتفاصيل حالة جسم السيارة من الخارج والداخل، ومعلومات العميل وتوقيعه.
        </p>
        <p>التاريخ: {{ report.date|date:"Y-m-d" }} {{ report.date|date:"H:i" }}</p>
    </div>

    <div class="car-info-section">
        <div>
            <table class="car-details">
                <tr>
                    <th>رقم عقد الإيجار</th>
                    <td>{{ report.reservation.id }}</td>
                </tr>
                <tr>
                    <th>اسم العميل</th>
                    <td>{{ report.customer.full_name }}</td>
                </tr>
                <tr>
                    <th>رقم الهوية</th>
                    <td>{{ report.customer.id_number }}</td>
                </tr>
                <tr>
                    <th>رقم الهاتف</th>
                    <td>{{ report.customer.phone }}</td>
                </tr>
            </table>
        </div>
        <div>
            <table class="car-details">
                <tr>
                    <th>موديل السيارة</th>
                    <td>{{ report.car.model_name }}</td>
                </tr>
                <tr>
                    <th>سنة الصنع</th>
                    <td>{{ report.car.year }}</td>
                </tr>
                <tr>
                    <th>رقم اللوحة</th>
                    <td>{{ report.car.plate_number }}</td>
                </tr>
                <tr>
                    <th>مستوى الوقود</th>
                    <td>{{ report.get_fuel_level_display }}</td>
                </tr>
                <tr>
                    <th>قراءة العداد</th>
                    <td>{{ report.mileage }} كم</td>
                </tr>
            </table>
        </div>
    </div>

    <div class="car-views-container">
        <div class="car-images">
            <div class="car-image">
                <img src="{% static 'car_images/front.png' %}" alt="الواجهة الأمامية">
            </div>
            <div class="car-image">
                <img src="{% static 'car_images/rear.png' %}" alt="الواجهة الخلفية">
            </div>
            <div class="car-image">
                <img src="{% static 'car_images/side.png' %}" alt="المنظر الجانبي">
            </div>
            <div class="car-image">
                <img src="{% static 'car_images/side2.png' %}" alt="المنظر الجانبي الآخر">
            </div>
            <div class="car-top-view">
                <img src="{% static 'car_images/top.png' %}" alt="المنظر العلوي">
            </div>
        </div>
    </div>

    <table class="car-details">
        <tr>
            <th colspan="2">حالة السيارة عند التسليم</th>
        </tr>
        {% for category_id, category in categories.items %}
            <tr>
                <th colspan="2">{{ category.name }}</th>
            </tr>
            {% for detail in category.items %}
                <tr>
                    <th>{{ detail.inspection_item.name }}</th>
                    <td class="{% if detail.status == 'damaged' %}inspection-item-damaged{% elif detail.status == 'warning' %}inspection-item-warning{% else %}inspection-item-normal{% endif %}">
                        {{ detail.get_status_display }}
                        {% if detail.notes %}
                        <br><small>{{ detail.notes }}</small>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        {% endfor %}
    </table>

    <div class="terms-section">
        <p>أقر أنا الموقع أدناه بأنني استلمت السيارة المذكورة أعلاه بالحالة الموضحة في هذا النموذج وأتعهد بإعادتها بنفس الحالة. وفي حال وجود أي تلف او ضرر جديد سيتم احتساب تكلفة الإصلاح حسب سياسة الشركة.</p>
    </div>

    <div class="signatures">
        <div class="signature-box">
            <p>توقيع المستلم</p>
            {% if customer_signature %}
                <img src="{{ customer_signature.signature.url }}" alt="توقيع العميل" style="max-height: 60px;">
            {% endif %}
        </div>
        <div class="signature-box">
            <p>توقيع الموظف</p>
            {% if staff_signature %}
                <img src="{{ staff_signature.signature.url }}" alt="توقيع الموظف" style="max-height: 60px;">
            {% endif %}
        </div>
        <div class="signature-box">
            <p>تاريخ الاستلام</p>
            <p>{{ report.date|date:"Y-m-d" }}</p>
        </div>
        <div class="signature-box">
            <p>ختم الشركة</p>
        </div>
    </div>

    <button onclick="window.print()" class="print-button no-print">
        <i class="fas fa-print"></i> طباعة النموذج
    </button>
</div>
{% endblock %}