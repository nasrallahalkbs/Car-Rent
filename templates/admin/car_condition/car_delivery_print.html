{% extends "admin/base_site_print.html" %}
{% load i18n static %}

{% block title %}{% trans "نموذج تسليم سيارة" %} - {{ report.car.model_name }} {{ report.car.year }}{% endblock %}

{% block extrahead %}
<style>
    @media print {
        @page {
            size: A4 portrait;
            margin: 0.5cm;
        }
        
        body {
            font-family: 'Tajawal', 'Cairo', sans-serif;
            line-height: 1.3;
            color: #000;
            background: #fff;
            margin: 0;
            padding: 0;
            font-size: 11px;
        }
        
        .print-container {
            width: 100%;
            max-width: 21cm;
            margin: 0 auto;
            background: #fff;
            padding: 0;
        }
        
        .header-section {
            text-align: right;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #ccc;
        }
        
        .header-section h2 {
            margin: 0;
            font-size: 16px;
            font-weight: bold;
        }
        
        .header-section p {
            margin: 5px 0;
            font-size: 10px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 60% 40%;
            gap: 10px;
        }
        
        .left-column {
            border-left: 1px solid #ccc;
            padding-left: 10px;
        }
        
        .search-box {
            border: 1px solid #ddd;
            padding: 5px;
            margin-bottom: 10px;
            display: flex;
            border-radius: 2px;
        }
        
        .search-box input {
            border: none;
            width: 100%;
            padding: 2px 5px;
            font-size: 11px;
        }
        
        .customer-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .info-box {
            border: 1px solid #ddd;
            border-radius: 2px;
            padding: 3px;
            font-size: 9px;
        }
        
        .info-box .label {
            color: #777;
            display: block;
            margin-bottom: 2px;
        }
        
        .info-box .value {
            font-weight: bold;
        }
        
        .car-specs {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 5px;
            margin-bottom: 10px;
            font-size: 9px;
        }
        
        table.inspection-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 9px;
            margin-bottom: 10px;
        }
        
        table.inspection-table th, 
        table.inspection-table td {
            border: 1px solid #ddd;
            padding: 2px 3px;
            text-align: right;
        }
        
        table.inspection-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            width: 40%;
        }
        
        .car-views {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .car-view {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .car-view img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        
        .car-image-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .terms-section {
            border: 1px solid #ddd;
            padding: 8px;
            margin: 10px 0;
            font-size: 9px;
            background-color: #f9f9f9;
        }
        
        .signatures {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .signature-box {
            border-top: 1px solid #ddd;
            padding-top: 5px;
            text-align: center;
            font-size: 9px;
        }
        
        .inspection-item-normal {
            color: #28a745;
        }
        
        .inspection-item-damaged {
            color: #dc3545;
        }
        
        .inspection-item-warning {
            color: #ffc107;
        }
        
        .btn, .navbar, footer, .no-print {
            display: none !important;
        }
    }

    /* Non-print styles */
    body {
        background-color: #f4f6f9;
        font-family: 'Tajawal', 'Cairo', sans-serif;
    }
    
    .print-container {
        width: 100%;
        max-width: 21cm;
        margin: 20px auto;
        background: #fff;
        padding: 20px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        border-radius: 5px;
    }
    
    .header-section {
        text-align: right;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #ccc;
    }
    
    .header-section h2 {
        margin: 0;
        font-size: 22px;
        font-weight: bold;
    }
    
    .header-section p {
        margin: 10px 0;
        font-size: 14px;
    }
    
    .main-grid {
        display: grid;
        grid-template-columns: 60% 40%;
        gap: 20px;
    }
    
    .left-column {
        border-left: 1px solid #ccc;
        padding-left: 20px;
    }
    
    .search-box {
        border: 1px solid #ddd;
        padding: 10px;
        margin-bottom: 15px;
        display: flex;
        border-radius: 4px;
    }
    
    .search-box input {
        border: none;
        width: 100%;
        padding: 5px 10px;
        font-size: 14px;
    }
    
    .customer-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-bottom: 15px;
    }
    
    .info-box {
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 10px;
        font-size: 14px;
    }
    
    .info-box .label {
        color: #777;
        display: block;
        margin-bottom: 5px;
    }
    
    .info-box .value {
        font-weight: bold;
    }
    
    .car-specs {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 10px;
        margin-bottom: 15px;
    }
    
    table.inspection-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
        margin-bottom: 15px;
    }
    
    table.inspection-table th, 
    table.inspection-table td {
        border: 1px solid #ddd;
        padding: 8px 10px;
        text-align: right;
    }
    
    table.inspection-table th {
        background-color: #f8f9fa;
        font-weight: 600;
        width: 40%;
    }
    
    .car-views {
        display: grid;
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .car-view {
        text-align: center;
        margin-bottom: 15px;
    }
    
    .car-view img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 0 auto;
    }
    
    .car-image-container {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    .terms-section {
        border: 1px solid #ddd;
        padding: 15px;
        margin: 15px 0;
        font-size: 13px;
        background-color: #f9f9f9;
    }
    
    .signatures {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr;
        gap: 15px;
        margin-top: 20px;
    }
    
    .signature-box {
        border-top: 1px solid #ddd;
        padding-top: 10px;
        text-align: center;
        font-size: 13px;
    }
    
    .inspection-item-normal {
        color: #28a745;
    }
    
    .inspection-item-damaged {
        color: #dc3545;
    }
    
    .inspection-item-warning {
        color: #ffc107;
    }

    .print-button {
        display: block;
        margin: 20px auto;
        padding: 10px 15px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1em;
    }
</style>
{% endblock %}

{% block content %}
<div class="print-container">
    <div class="header-section">
        <h2>نموذج تسليم سيارة</h2>
        <p>
            يحتوي هذا النموذج على معلومات حالة السيارة عند تسليمها للعميل، ويتضمن تفاصيل السيارة والعميل وحالة أجزاء السيارة.
        </p>
    </div>

    <div class="main-grid">
        <div class="left-column">
            <!-- معلومات العميل والسيارة -->
            <div class="search-box">
                <input type="text" placeholder="بحث عن حالة السيارة" disabled>
            </div>
            
            <div class="customer-info">
                <div class="info-box">
                    <span class="label">رقم عقد الإيجار</span>
                    <span class="value">{{ report.reservation.id }}</span>
                </div>
                <div class="info-box">
                    <span class="label">اسم العميل</span>
                    <span class="value">{{ report.customer.full_name }}</span>
                </div>
                <div class="info-box">
                    <span class="label">تاريخ التسليم</span>
                    <span class="value">{{ report.date|date:"Y-m-d" }}</span>
                </div>
                <div class="info-box">
                    <span class="label">رقم الهوية</span>
                    <span class="value">{{ report.customer.id_number }}</span>
                </div>
            </div>
            
            <div class="car-specs">
                <div class="info-box">
                    <span class="label">موديل السيارة</span>
                    <span class="value">{{ report.car.make }} {{ report.car.model }}</span>
                </div>
                <div class="info-box">
                    <span class="label">سنة الصنع</span>
                    <span class="value">{{ report.car.year }}</span>
                </div>
                <div class="info-box">
                    <span class="label">رقم اللوحة</span>
                    <span class="value">{{ report.car.license_plate }}</span>
                </div>
                <div class="info-box">
                    <span class="label">قراءة العداد</span>
                    <span class="value">{{ report.mileage }} كم</span>
                </div>
                <div class="info-box">
                    <span class="label">لون السيارة</span>
                    <span class="value">{{ report.car.color }}</span>
                </div>
                <div class="info-box">
                    <span class="label">مستوى الوقود</span>
                    <span class="value">{{ report.get_fuel_level_display }}</span>
                </div>
                <div class="info-box">
                    <span class="label">ناقل الحركة</span>
                    <span class="value">{{ report.car.get_transmission_display }}</span>
                </div>
                <div class="info-box">
                    <span class="label">فئة السيارة</span>
                    <span class="value">{{ report.car.get_category_display }}</span>
                </div>
                <div class="info-box">
                    <span class="label">حالة السيارة</span>
                    <span class="value">{{ report.get_car_condition_display }}</span>
                </div>
            </div>
            
            <!-- تفاصيل فحص السيارة -->
            <table class="inspection-table">
                <tr>
                    <th colspan="2">حالة السيارة عند التسليم</th>
                </tr>
                {% for category_id, category in categories.items %}
                    <tr>
                        <th colspan="2">{{ category.name }}</th>
                    </tr>
                    {% for detail in category.items %}
                        <tr>
                            <th>{{ detail.inspection_item.name }}</th>
                            <td class="{% if detail.status == 'damaged' %}inspection-item-damaged{% elif detail.status == 'warning' %}inspection-item-warning{% else %}inspection-item-normal{% endif %}">
                                {{ detail.get_status_display }}
                                {% if detail.notes %}
                                <small class="notes">({{ detail.notes }})</small>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                {% endfor %}
            </table>
            
            <!-- شروط التسليم -->
            <div class="terms-section">
                <p>أقر أنا الموقع أدناه بأنني استلمت السيارة المذكورة أعلاه بالحالة الموضحة في هذا النموذج وأتعهد بإعادتها بنفس الحالة. وفي حال وجود أي تلف او ضرر جديد سيتم احتساب تكلفة الإصلاح حسب سياسة الشركة.</p>
            </div>
            
            <!-- التوقيعات -->
            <div class="signatures">
                <div class="signature-box">
                    <p>توقيع المستلم</p>
                    {% if customer_signature %}
                        <img src="{{ customer_signature.signature.url }}" alt="توقيع العميل" style="max-height: 40px;">
                    {% endif %}
                </div>
                <div class="signature-box">
                    <p>ختم الشركة</p>
                </div>
                <div class="signature-box">
                    <p>توقيع الموظف</p>
                    {% if staff_signature %}
                        <img src="{{ staff_signature.signature.url }}" alt="توقيع الموظف" style="max-height: 40px;">
                    {% endif %}
                </div>
                <div class="signature-box">
                    <p>تاريخ الاستلام</p>
                    <p>{{ report.date|date:"Y-m-d" }}</p>
                </div>
            </div>
        </div>
        
        <div class="right-column">
            <!-- صور السيارة -->
            <div class="car-views">
                <div class="car-view">
                    <img src="{% static 'car_images/front.png' %}" alt="الواجهة الأمامية">
                </div>
                <div class="car-view">
                    <img src="{% static 'car_images/rear.png' %}" alt="الواجهة الخلفية">
                </div>
                <div class="car-view">
                    <img src="{% static 'car_images/side.png' %}" alt="المنظر الجانبي">
                </div>
                <div class="car-view">
                    <img src="{% static 'car_images/side2.png' %}" alt="المنظر الجانبي الآخر">
                </div>
                <div class="car-view">
                    <img src="{% static 'car_images/top.png' %}" alt="المنظر العلوي">
                </div>
            </div>
        </div>
    </div>

    <button onclick="window.print()" class="print-button no-print">
        <i class="fas fa-print"></i> طباعة النموذج
    </button>
</div>
{% endblock %}