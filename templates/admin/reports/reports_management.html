{% extends "admin/enhanced/admin_layout.html" %}
<!-- CACHE_BUSTER {{ now.timestamp|floatformat:0 }} -->
{% load i18n %}
{% load static %}
{% load custom_filters %}

{% block title %}{% trans "إدارة التقارير" %} - كاررنتال{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/reports_management.css' %}?v={{ now.timestamp|floatformat:0 }}">
{% endblock %}

{% block content %}
<div class="container-fluid p-0">
    <!-- نبدأ مباشرة بالتبويبات في أعلى الصفحة -->
    <div class="reports-container reports-container-full">
        <!-- شريط التبويبات بتصميم البرامج القديمة (Classic Desktop Menu) -->
        <div class="ribbon-menu">
            <!-- صف التبويبات العلوي -->
            <div class="menu-tabs">
                <div class="ribbon-tab active" data-tab="reservations">
                    <i class="fas fa-calendar-check"></i> {% trans "الحجوزات" %}
                </div>
                <div class="ribbon-tab" data-tab="cars">
                    <i class="fas fa-car"></i> {% trans "السيارات" %}
                </div>
                <div class="ribbon-tab" data-tab="customers">
                    <i class="fas fa-users"></i> {% trans "العملاء" %}
                </div>
                <div class="ribbon-tab" data-tab="custody">
                    <i class="fas fa-key"></i> {% trans "العهدة" %}
                </div>
                <div class="ribbon-tab" data-tab="car-conditions">
                    <i class="fas fa-car-crash"></i> {% trans "حالة السيارات" %}
                </div>
                <div class="ribbon-tab" data-tab="payments">
                    <i class="fas fa-file-invoice-dollar"></i> {% trans "المدفوعات" %}
                </div>
            </div>

            <!-- القسم الذي يحتوي على أزرار الأدوات -->
            <div class="menu-content">
                <div class="toolbar-section">
                    <div class="toolbar-btn btn-add">
                        <i class="fas fa-plus"></i> {% trans "إضافة" %}
                    </div>
                    <div class="toolbar-btn btn-edit">
                        <i class="fas fa-edit"></i> {% trans "تعديل" %}
                    </div>
                    <div class="toolbar-btn btn-delete">
                        <i class="fas fa-trash"></i> {% trans "حذف" %}
                    </div>
                </div>
                
                <div class="toolbar-section">
                    <div class="toolbar-btn btn-pdf">
                        <i class="fas fa-file-pdf"></i> {% trans "PDF" %}
                    </div>
                    <div class="toolbar-btn btn-excel">
                        <i class="fas fa-file-excel"></i> {% trans "Excel" %}
                    </div>
                    <div class="toolbar-btn btn-print">
                        <i class="fas fa-print"></i> {% trans "طباعة" %}
                    </div>
                </div>
                
                <div class="toolbar-section">
                    <div class="toolbar-btn btn-save">
                        <i class="fas fa-save"></i> {% trans "حفظ التقرير" %}
                    </div>
                </div>
            </div>
        </div>

        <!-- منطقة المحتوى -->
        <div class="tab-content">
            <!-- تبويب الحجوزات -->
            <div class="tab-pane active" id="reservations-tab">
                <!-- قسم الفلاتر -->
                <div class="filters-section">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="filter-label">{% trans "الفترة الزمنية" %}</label>
                            <select class="form-select">
                                <option value="all">{% trans "كل الفترات" %}</option>
                                <option value="today">{% trans "اليوم" %}</option>
                                <option value="week">{% trans "هذا الأسبوع" %}</option>
                                <option value="month">{% trans "هذا الشهر" %}</option>
                                <option value="custom">{% trans "تاريخ محدد" %}</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">{% trans "من تاريخ" %}</label>
                            <input type="date" class="form-control">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">{% trans "إلى تاريخ" %}</label>
                            <input type="date" class="form-control">
                        </div>
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label class="filter-label">{% trans "حالة الحجز" %}</label>
                            <select class="form-select">
                                <option value="all">{% trans "جميع الحالات" %}</option>
                                <option value="confirmed">{% trans "مؤكد" %}</option>
                                <option value="pending">{% trans "قيد الانتظار" %}</option>
                                <option value="completed">{% trans "مكتمل" %}</option>
                                <option value="cancelled">{% trans "ملغي" %}</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">{% trans "المسؤول" %}</label>
                            <select class="form-select">
                                <option value="all">{% trans "جميع المسؤولين" %}</option>
                                {% for admin in admins %}
                                <option value="{{ admin.id }}">{{ admin.username }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">{% trans "بحث" %}</label>
                            <input type="text" class="form-control" placeholder="{% trans 'اسم أو رقم الحجز' %}">
                        </div>
                    </div>
                    <div class="filter-buttons">
                        <button class="btn btn-outline-secondary">{% trans "إعادة تعيين" %}</button>
                        <button class="btn btn-primary">{% trans "تطبيق" %}</button>
                    </div>
                </div>

                <!-- جدول البيانات -->
                <div class="table-responsive">
                    <table class="reports-table">
                        <thead>
                            <tr>
                                <th width="30px">
                                    <input type="checkbox" class="form-check-input" id="select-all">
                                </th>
                                <th>{% trans "رقم الحجز" %}</th>
                                <th>{% trans "السيارة" %}</th>
                                <th>{% trans "تاريخ الحجز" %}</th>
                                <th>{% trans "تاريخ الاستلام" %}</th>
                                <th>{% trans "تاريخ التسليم" %}</th>
                                <th>{% trans "المبلغ" %}</th>
                                <th>{% trans "حالة الحجز" %}</th>
                                <th>{% trans "المسؤول" %}</th>
                                <th>{% trans "إجراءات" %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for reservation in reservations %}
                            <tr>
                                <td>
                                    <input type="checkbox" class="form-check-input row-checkbox">
                                </td>
                                <td>{{ reservation.id }}</td>
                                <td>{{ reservation.car.make }} {{ reservation.car.model }}</td>
                                <td>{{ reservation.created_at|date:"Y-m-d" }}</td>
                                <td>{{ reservation.start_date|date:"Y-m-d" }}</td>
                                <td>{{ reservation.end_date|date:"Y-m-d" }}</td>
                                <td>{{ reservation.total_amount }} {% trans "ريال" %}</td>
                                <td>
                                    {% if reservation.status == 'confirmed' %}
                                    <span class="reservation-status confirmed">{% trans "مؤكد" %}</span>
                                    {% elif reservation.status == 'pending' %}
                                    <span class="reservation-status pending">{% trans "قيد الانتظار" %}</span>
                                    {% elif reservation.status == 'completed' %}
                                    <span class="reservation-status completed">{% trans "مكتمل" %}</span>
                                    {% elif reservation.status == 'cancelled' %}
                                    <span class="reservation-status cancelled">{% trans "ملغي" %}</span>
                                    {% endif %}
                                </td>
                                <td>{{ reservation.admin.username }}</td>
                                <td class="action-btns">
                                    <a href="#" title="{% trans 'عرض' %}"><i class="fas fa-eye"></i></a>
                                    <a href="#" title="{% trans 'تعديل' %}"><i class="fas fa-edit"></i></a>
                                    <a href="#" title="{% trans 'طباعة' %}"><i class="fas fa-print"></i></a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="10" class="text-center py-3">{% trans "لا توجد حجوزات" %}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- باقي التبويبات (سيتم تفعيلها لاحقاً) -->
            <div class="tab-pane" id="cars-tab" style="display: none;">
                <!-- محتوى تبويب السيارات -->
            </div>
            <div class="tab-pane" id="customers-tab" style="display: none;">
                <!-- محتوى تبويب العملاء -->
            </div>
            <div class="tab-pane" id="custody-tab" style="display: none;">
                <!-- محتوى تبويب العهدة -->
            </div>
            <div class="tab-pane" id="car-conditions-tab" style="display: none;">
                <!-- محتوى تبويب حالة السيارات -->
            </div>
            <div class="tab-pane" id="payments-tab" style="display: none;">
                <!-- محتوى تبويب المدفوعات -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // التبديل بين التبويبات
    const ribbonTabs = document.querySelectorAll('.ribbon-tab');
    const tabPanes = document.querySelectorAll('.tab-pane');

    ribbonTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            // إزالة الفئة النشطة من جميع التبويبات
            ribbonTabs.forEach(t => t.classList.remove('active'));
            
            // إضافة الفئة النشطة للتبويب المحدد
            tab.classList.add('active');
            
            // إخفاء جميع المحتويات
            tabPanes.forEach(pane => pane.style.display = 'none');
            
            // عرض المحتوى المناسب
            const tabId = tab.getAttribute('data-tab');
            document.getElementById(tabId + '-tab').style.display = 'block';
        });
    });
    
    // التحقق من مربعات الاختيار
    const mainCheckbox = document.getElementById('select-all');
    const rowCheckboxes = document.querySelectorAll('.row-checkbox');
    
    if (mainCheckbox) {
        mainCheckbox.addEventListener('change', function() {
            rowCheckboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });
    }
    
    // تحديث مربع الاختيار الرئيسي عندما تتغير حالة مربعات الاختيار الفردية
    rowCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const allChecked = Array.from(rowCheckboxes).every(c => c.checked);
            const someChecked = Array.from(rowCheckboxes).some(c => c.checked);
            
            if (mainCheckbox) {
                mainCheckbox.checked = allChecked;
                mainCheckbox.indeterminate = someChecked && !allChecked;
            }
        });
    });
});
</script>
{% endblock %}