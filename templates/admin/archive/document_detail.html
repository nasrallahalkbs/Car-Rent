<!-- CACHE_BUSTER 1745274702 -->{% extends 'admin_layout.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Document Details" %} - {{ document.title }}{% endblock %}

{% block page_title %}{% trans "Document Details" %}{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'admin_archive' %}">{% trans "Document Archive" %}</a></li>
<li class="breadcrumb-item active">{% trans "Document Details" %}</li>
{% endblock %}

{% block extra_css %}
<style>
    .document-detail-card {
        border-radius: 0.75rem;
        overflow: hidden;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    .document-header {
        display: flex;
        align-items: center;
        padding: 1.5rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .document-icon {
        width: 64px;
        height: 64px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-{% if is_english %}right{% else %}left{% endif %}: 1.25rem;
        font-size: 1.75rem;
    }
    
    .document-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
        line-height: 1.4;
    }
    
    .document-subtitle {
        color: #64748b;
        font-size: 1rem;
    }
    
    .document-content {
        padding: 1.5rem;
    }
    
    .document-section {
        margin-bottom: 1.5rem;
    }
    
    .section-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #e2e8f0;
        color: #475569;
    }
    
    .info-row {
        display: flex;
        margin-bottom: 0.75rem;
    }
    
    .info-label {
        width: 150px;
        font-weight: 500;
        color: #64748b;
    }
    
    .info-value {
        flex: 1;
        color: #334155;
    }
    
    .document-preview {
        margin-bottom: 1.5rem;
        border-radius: 0.5rem;
        overflow: hidden;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    }
    
    .document-preview-image {
        max-width: 100%;
        max-height: 400px;
        display: block;
        margin: 0 auto;
    }
    
    .document-preview-placeholder {
        background-color: #f8fafc;
        padding: 3rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
    }
    
    .document-action-button {
        padding: 0.75rem 1.25rem;
        border-radius: 0.5rem;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        margin-bottom: 0.5rem;
        margin-{% if is_english %}right{% else %}left{% endif %}: 0.5rem;
        white-space: nowrap;
    }
    
    .document-action-button i {
        margin-{% if is_english %}right{% else %}left{% endif %}: 0.5rem;
    }
    
    .document-action-panel {
        background-color: #f8fafc;
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .document-action-panel .section-title {
        border-bottom: none;
        margin-bottom: 1.25rem;
    }
    
    .document-tag {
        display: inline-block;
        padding: 0.35rem 0.75rem;
        background-color: #f1f5f9;
        color: #475569;
        border-radius: 1rem;
        font-size: 0.875rem;
        margin-{% if is_english %}right{% else %}left{% endif %}: 0.5rem;
        margin-bottom: 0.5rem;
    }
    
    .related-entity-card {
        border-radius: 0.75rem;
        overflow: hidden;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        margin-bottom: 1.5rem;
    }
    
    .related-entity-header {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        background-color: #f8fafc;
    }
    
    .related-entity-content {
        padding: 1.5rem;
    }
    
    .document-history-item {
        display: flex;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .document-history-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #f1f5f9;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-{% if is_english %}right{% else %}left{% endif %}: 1rem;
        color: #475569;
    }
    
    .document-history-details {
        flex: 1;
    }
    
    .document-history-title {
        font-weight: 500;
        margin-bottom: 0.25rem;
    }
    
    .document-history-date {
        font-size: 0.875rem;
        color: #64748b;
    }
    
    .btn-icon-only {
        width: 40px;
        height: 40px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        padding: 0;
        margin-{% if is_english %}right{% else %}left{% endif %}: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h2 mb-0">{{ document.title }}</h1>
                    <p class="text-muted">{% trans "Document ID" %}: {{ document.reference_number|default:document.id }}</p>
                </div>
                <div>
                    <a href="{% url 'admin_archive' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i> {% trans "Back to Archive" %}
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-8">
            <!-- بطاقة المستند -->
            <div class="document-detail-card bg-white mb-4">
                <div class="document-header">
                    <div class="document-icon" style="
                        {% if document.document_type == 'contract' %}
                        background-color: #dbeafe; color: #2563eb;
                        {% elif document.document_type == 'receipt' %}
                        background-color: #dcfce7; color: #16a34a;
                        {% elif document.document_type == 'custody' %}
                        background-color: #fef3c7; color: #d97706;
                        {% elif document.document_type == 'custody_release' %}
                        background-color: #fce7f3; color: #db2777;
                        {% elif document.document_type == 'official_document' %}
                        background-color: #f3e8ff; color: #9333ea;
                        {% else %}
                        background-color: #f1f5f9; color: #475569;
                        {% endif %}
                    ">
                        {% if document.document_type == 'contract' %}
                        <i class="fas fa-file-contract"></i>
                        {% elif document.document_type == 'receipt' %}
                        <i class="fas fa-receipt"></i>
                        {% elif document.document_type == 'custody' %}
                        <i class="fas fa-key"></i>
                        {% elif document.document_type == 'custody_release' %}
                        <i class="fas fa-unlock-alt"></i>
                        {% elif document.document_type == 'official_document' %}
                        <i class="fas fa-stamp"></i>
                        {% else %}
                        <i class="fas fa-file-alt"></i>
                        {% endif %}
                    </div>
                    <div>
                        <h1 class="document-title">{{ document.title }}</h1>
                        <div class="document-subtitle">
                            <span class="me-2">{{ document.reference_number }}</span>
                            <span class="badge 
                                {% if document.document_type == 'contract' %}
                                bg-primary
                                {% elif document.document_type == 'receipt' %}
                                bg-success
                                {% elif document.document_type == 'custody' %}
                                bg-warning
                                {% elif document.document_type == 'custody_release' %}
                                bg-danger
                                {% elif document.document_type == 'official_document' %}
                                bg-purple
                                {% else %}
                                bg-secondary
                                {% endif %}
                            ">
                                {% if document.document_type == 'contract' %}
                                {% trans "Contract" %}
                                {% elif document.document_type == 'receipt' %}
                                {% trans "Receipt" %}
                                {% elif document.document_type == 'custody' %}
                                {% trans "Custody" %}
                                {% elif document.document_type == 'custody_release' %}
                                {% trans "Custody Release" %}
                                {% elif document.document_type == 'official_document' %}
                                {% trans "Official Document" %}
                                {% else %}
                                {% trans "Other" %}
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="document-content">
                    <!-- معاينة المستند -->
                    <div class="document-section">
                        <h3 class="section-title">{% trans "Document Preview" %}</h3>
                        
                        <div class="document-preview">
                            {% if document.is_image %}
                            <img src="{{ document.file.url }}" class="document-preview-image" alt="{{ document.title }}">
                            {% elif document.is_pdf %}
                            <div class="document-preview-placeholder">
                                <i class="fas fa-file-pdf fa-5x text-danger mb-3"></i>
                                <h4>{% trans "PDF Document" %}</h4>
                                <p class="text-muted">{% trans "This document is a PDF file. Use the view or download buttons below to access the full document." %}</p>
                                <div class="mt-3">
                                    <a href="{% url 'admin_archive_view' document.id %}" target="_blank" class="btn btn-primary me-2">
                                        <i class="fas fa-eye me-2"></i> {% trans "View PDF" %}
                                    </a>
                                    <a href="{% url 'admin_archive_download' document.id %}" class="btn btn-outline-primary">
                                        <i class="fas fa-download me-2"></i> {% trans "Download" %}
                                    </a>
                                </div>
                            </div>
                            {% else %}
                            <div class="document-preview-placeholder">
                                <i class="fas fa-file fa-5x text-secondary mb-3"></i>
                                <h4>{% trans "Document File" %}</h4>
                                <p class="text-muted">{% trans "This document type cannot be previewed directly. You can download the file to view its contents." %}</p>
                                <div class="mt-3">
                                    <a href="{% url 'admin_archive_download' document.id %}" class="btn btn-primary">
                                        <i class="fas fa-download me-2"></i> {% trans "Download File" %}
                                    </a>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- معلومات المستند -->
                    <div class="document-section">
                        <h3 class="section-title">{% trans "Document Information" %}</h3>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-row">
                                    <div class="info-label">{% trans "Document Title" %}</div>
                                    <div class="info-value">{{ document.title }}</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">{% trans "Reference Number" %}</div>
                                    <div class="info-value">{{ document.reference_number|default:"-" }}</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">{% trans "Document Type" %}</div>
                                    <div class="info-value">
                                        {% if document.document_type == 'contract' %}
                                        {% trans "Contract" %}
                                        {% elif document.document_type == 'receipt' %}
                                        {% trans "Receipt" %}
                                        {% elif document.document_type == 'custody' %}
                                        {% trans "Custody" %}
                                        {% elif document.document_type == 'custody_release' %}
                                        {% trans "Custody Release" %}
                                        {% elif document.document_type == 'official_document' %}
                                        {% trans "Official Document" %}
                                        {% else %}
                                        {% trans "Other" %}
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">{% trans "Created By" %}</div>
                                    <div class="info-value">
                                        {% if document.added_by %}
                                        {{ document.added_by.first_name|default:document.added_by.username }}
                                        {% else %}
                                        {% trans "Unknown" %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-row">
                                    <div class="info-label">{% trans "Document Date" %}</div>
                                    <div class="info-value">{{ document.document_date|date:"j F Y" }}</div>
                                </div>
                                {% if document.expiry_date %}
                                <div class="info-row">
                                    <div class="info-label">{% trans "Expiry Date" %}</div>
                                    <div class="info-value">{{ document.expiry_date|date:"j F Y" }}</div>
                                </div>
                                {% endif %}
                                <div class="info-row">
                                    <div class="info-label">{% trans "Date Added" %}</div>
                                    <div class="info-value">{{ document.created_at|date:"j F Y H:i" }}</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">{% trans "Last Updated" %}</div>
                                    <div class="info-value">{{ document.updated_at|date:"j F Y H:i" }}</div>
                                </div>
                            </div>
                        </div>
                        
                        {% if document.description %}
                        <div class="info-row mt-3">
                            <div class="info-label">{% trans "Description" %}</div>
                            <div class="info-value">{{ document.description }}</div>
                        </div>
                        {% endif %}
                        
                        {% if document.tags %}
                        <div class="info-row mt-3">
                            <div class="info-label">{% trans "Tags" %}</div>
                            <div class="info-value">
                                {% for tag in document.tags_list %}
                                <span class="document-tag">{{ tag }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- معلومات الملف -->
                    <div class="document-section">
                        <h3 class="section-title">{% trans "File Information" %}</h3>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="info-row">
                                    <div class="info-label">{% trans "File Type" %}</div>
                                    <div class="info-value">
                                        {% if document.is_image %}
                                        {% trans "Image" %} (.{{ document.file_extension }})
                                        {% elif document.is_pdf %}
                                        {% trans "PDF Document" %}
                                        {% else %}
                                        {{ document.file_extension|upper }} {% trans "File" %}
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">{% trans "File Size" %}</div>
                                    <div class="info-value">{{ document.file_size_display }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-row">
                                    <div class="info-label">{% trans "File Path" %}</div>
                                    <div class="info-value" style="word-break: break-all;">{{ document.file.name }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- الكيان المرتبط -->
                    {% if related_entity %}
                    <div class="document-section">
                        <h3 class="section-title">{% trans "Related Information" %}</h3>
                        
                        <div class="related-entity-card">
                            <div class="related-entity-header">
                                <h5 class="mb-0">
                                    {% if related_entity_type == 'reservation' %}
                                    <i class="fas fa-calendar-alt me-2"></i> {% trans "Reservation Details" %}
                                    {% elif related_entity_type == 'car' %}
                                    <i class="fas fa-car me-2"></i> {% trans "Car Details" %}
                                    {% elif related_entity_type == 'user' %}
                                    <i class="fas fa-user me-2"></i> {% trans "User Details" %}
                                    {% endif %}
                                </h5>
                            </div>
                            <div class="related-entity-content">
                                {% if related_entity_type == 'reservation' %}
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Reservation ID" %}</div>
                                            <div class="info-value">#{{ related_entity.id }}</div>
                                        </div>
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Customer" %}</div>
                                            <div class="info-value">{{ related_entity.user.first_name|default:related_entity.user.username }}</div>
                                        </div>
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Car" %}</div>
                                            <div class="info-value">{{ related_entity.car.make }} {{ related_entity.car.model }}</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Pickup Date" %}</div>
                                            <div class="info-value">{{ related_entity.pickup_date|date:"j F Y" }}</div>
                                        </div>
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Return Date" %}</div>
                                            <div class="info-value">{{ related_entity.return_date|date:"j F Y" }}</div>
                                        </div>
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Status" %}</div>
                                            <div class="info-value">
                                                <span class="badge 
                                                    {% if related_entity.status == 'confirmed' %}
                                                    bg-success
                                                    {% elif related_entity.status == 'pending' %}
                                                    bg-warning
                                                    {% elif related_entity.status == 'cancelled' %}
                                                    bg-danger
                                                    {% elif related_entity.status == 'completed' %}
                                                    bg-primary
                                                    {% else %}
                                                    bg-secondary
                                                    {% endif %}
                                                ">
                                                    {% if related_entity.status == 'confirmed' %}
                                                    {% trans "Confirmed" %}
                                                    {% elif related_entity.status == 'pending' %}
                                                    {% trans "Pending" %}
                                                    {% elif related_entity.status == 'cancelled' %}
                                                    {% trans "Cancelled" %}
                                                    {% elif related_entity.status == 'completed' %}
                                                    {% trans "Completed" %}
                                                    {% else %}
                                                    {{ related_entity.status }}
                                                    {% endif %}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a href="{% url 'reservation_detail' related_entity.id %}" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-external-link-alt me-2"></i> {% trans "View Reservation" %}
                                    </a>
                                </div>
                                {% elif related_entity_type == 'car' %}
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Car ID" %}</div>
                                            <div class="info-value">#{{ related_entity.id }}</div>
                                        </div>
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Make & Model" %}</div>
                                            <div class="info-value">{{ related_entity.make }} {{ related_entity.model }}</div>
                                        </div>
                                        <div class="info-row">
                                            <div class="info-label">{% trans "License Plate" %}</div>
                                            <div class="info-value">{{ related_entity.license_plate }}</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Year" %}</div>
                                            <div class="info-value">{{ related_entity.year }}</div>
                                        </div>
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Category" %}</div>
                                            <div class="info-value">{{ related_entity.get_category_display }}</div>
                                        </div>
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Status" %}</div>
                                            <div class="info-value">
                                                <span class="badge {% if related_entity.is_available %}bg-success{% else %}bg-danger{% endif %}">
                                                    {% if related_entity.is_available %}
                                                    {% trans "Available" %}
                                                    {% else %}
                                                    {% trans "Unavailable" %}
                                                    {% endif %}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a href="{% url 'car_detail' related_entity.id %}" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-external-link-alt me-2"></i> {% trans "View Car" %}
                                    </a>
                                </div>
                                {% elif related_entity_type == 'user' %}
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="info-row">
                                            <div class="info-label">{% trans "User ID" %}</div>
                                            <div class="info-value">#{{ related_entity.id }}</div>
                                        </div>
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Name" %}</div>
                                            <div class="info-value">{{ related_entity.first_name }} {{ related_entity.last_name }}</div>
                                        </div>
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Username" %}</div>
                                            <div class="info-value">{{ related_entity.username }}</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Email" %}</div>
                                            <div class="info-value">{{ related_entity.email }}</div>
                                        </div>
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Date Joined" %}</div>
                                            <div class="info-value">{{ related_entity.date_joined|date:"j F Y" }}</div>
                                        </div>
                                        <div class="info-row">
                                            <div class="info-label">{% trans "Status" %}</div>
                                            <div class="info-value">
                                                <span class="badge {% if related_entity.is_active %}bg-success{% else %}bg-danger{% endif %}">
                                                    {% if related_entity.is_active %}
                                                    {% trans "Active" %}
                                                    {% else %}
                                                    {% trans "Inactive" %}
                                                    {% endif %}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a href="{% url 'user_details' related_entity.id %}" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-external-link-alt me-2"></i> {% trans "View User" %}
                                    </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <!-- أزرار الإجراءات -->
            <div class="document-action-panel mb-4">
                <h3 class="section-title">{% trans "Document Actions" %}</h3>
                
                <div class="d-grid gap-3">
                    <a href="{% url 'admin_archive_view' document.id %}" target="_blank" class="btn btn-primary document-action-button">
                        <i class="fas fa-eye"></i> {% trans "View Document" %}
                    </a>
                    <a href="{% url 'admin_archive_download' document.id %}" class="btn btn-info document-action-button">
                        <i class="fas fa-download"></i> {% trans "Download Document" %}
                    </a>
                    <a href="{% url 'admin_archive_edit' document.id %}" class="btn btn-warning document-action-button">
                        <i class="fas fa-edit"></i> {% trans "Edit Document" %}
                    </a>
                    <a href="{% url 'admin_archive_delete' document.id %}" class="btn btn-danger document-action-button">
                        <i class="fas fa-trash-alt"></i> {% trans "Delete Document" %}
                    </a>
                </div>
            </div>
            
            <!-- معلومات إضافية -->
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">{% trans "Document Metadata" %}</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <small class="text-muted d-block mb-1">{% trans "Created At" %}</small>
                        <div>{{ document.created_at|date:"j F Y H:i" }}</div>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted d-block mb-1">{% trans "Last Updated" %}</small>
                        <div>{{ document.updated_at|date:"j F Y H:i" }}</div>
                    </div>
                    <div class="mb-3">
                        <small class="text-muted d-block mb-1">{% trans "Added By" %}</small>
                        <div>
                            {% if document.added_by %}
                            {{ document.added_by.first_name|default:document.added_by.username }}
                            {% else %}
                            {% trans "Unknown" %}
                            {% endif %}
                        </div>
                    </div>
                    <div>
                        <small class="text-muted d-block mb-1">{% trans "File Type" %}</small>
                        <div>
                            {% if document.is_image %}
                            <i class="fas fa-file-image text-primary me-2"></i> {% trans "Image" %} (.{{ document.file_extension }})
                            {% elif document.is_pdf %}
                            <i class="fas fa-file-pdf text-danger me-2"></i> {% trans "PDF Document" %}
                            {% else %}
                            <i class="fas fa-file text-secondary me-2"></i> {{ document.file_extension|upper }} {% trans "File" %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- الوثائق ذات الصلة -->
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">{% trans "Search Documents" %}</h5>
                </div>
                <div class="card-body">
                    <form action="{% url 'admin_archive' %}" method="get">
                        <div class="mb-3">
                            <label for="search" class="form-label">{% trans "Search for similar documents" %}</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="search" name="search" placeholder="{% trans 'Search...' %}">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="filter_type" class="form-label">{% trans "Filter by Type" %}</label>
                            <select class="form-select" id="filter_type" name="document_type">
                                <option value="">{% trans "All Types" %}</option>
                                {% for type_value, type_name in document.DOCUMENT_TYPE_CHOICES %}
                                <option value="{{ type_value }}" {% if document.document_type == type_value %}selected{% endif %}>{{ type_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-outline-primary">
                                <i class="fas fa-filter me-2"></i> {% trans "Apply Filters" %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // يمكن إضافة سكريبتات إضافية هنا
    });
</script>
{% endblock %}

{% block additional_head %}
<style>
    .document-section {
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .document-header {
        border-bottom: 2px solid #e3e6f0;
        padding-bottom: 15px;
        margin-bottom: 20px;
    }
    
    .file-viewer {
        width: 100%;
        min-height: 500px;
        border: 1px solid #ddd;
        border-radius: 5px;
        overflow: hidden;
    }
    
    .file-preview {
        text-align: center;
        padding: 20px;
    }
    
    .file-preview img {
        max-width: 100%;
        max-height: 600px;
        border-radius: 5px;
    }
    
    .property-label {
        font-weight: bold;
        color: #4e73df;
    }
    
    .tags-container .badge {
        margin-right: 5px;
        margin-bottom: 5px;
        font-size: 0.9rem;
        padding: 6px 10px;
    }
    
    .relation-box {
        border: 1px solid #e3e6f0;
        border-radius: 5px;
        padding: 15px;
        margin-top: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">تفاصيل الوثيقة</h1>
        <div>
            <a href="{% url 'admin_edit_document' document.id %}" class="d-none d-sm-inline-block btn btn-warning shadow-sm me-2">
                <i class="fas fa-edit fa-sm text-white-50 ms-1"></i> تعديل
            </a>
            <a href="{% url 'admin_delete_document' document.id %}" class="d-none d-sm-inline-block btn btn-danger shadow-sm me-2">
                <i class="fas fa-trash fa-sm text-white-50 ms-1"></i> حذف
            </a>
            <a href="{% url 'admin_archive' %}" class="d-none d-sm-inline-block btn btn-secondary shadow-sm">
                <i class="fas fa-arrow-right fa-sm text-white-50 ms-1"></i> العودة إلى الأرشيف
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-4">
            <!-- معلومات الوثيقة -->
            <div class="card mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">معلومات الوثيقة</h6>
                </div>
                <div class="card-body">
                    <div class="document-header">
                        <h4>{{ document.title }}</h4>
                        <div class="mt-2">
                            {% if document.document_type == 'contract' %}
                            <span class="badge bg-success">عقد</span>
                            {% elif document.document_type == 'receipt' %}
                            <span class="badge bg-info">إيصال</span>
                            {% elif document.document_type == 'custody' %}
                            <span class="badge bg-warning">عهدة</span>
                            {% elif document.document_type == 'custody_release' %}
                            <span class="badge bg-danger">إخلاء عهدة</span>
                            {% elif document.document_type == 'official_document' %}
                            <span class="badge bg-primary">وثيقة رسمية</span>
                            {% else %}
                            <span class="badge bg-secondary">أخرى</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-6">
                            <p class="property-label">الرقم المرجعي</p>
                            <p>{{ document.reference_number }}</p>
                        </div>
                        <div class="col-6">
                            <p class="property-label">تاريخ الإضافة</p>
                            <p>{{ document.created_at|date:"d/m/Y" }}</p>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-6">
                            <p class="property-label">تاريخ المستند</p>
                            <p>{{ document.document_date|date:"d/m/Y" }}</p>
                        </div>
                        <div class="col-6">
                            <p class="property-label">تاريخ الانتهاء</p>
                            <p>{{ document.expiry_date|date:"d/m/Y"|default:"غير محدد" }}</p>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <p class="property-label">الوصف</p>
                        <p>{{ document.description|default:"لا يوجد وصف"|linebreaks }}</p>
                    </div>
                    
                    <div class="mb-3">
                        <p class="property-label">أضيف بواسطة</p>
                        <p>{{ document.added_by.get_full_name|default:document.added_by.username }}</p>
                    </div>
                    
                    <div class="mb-3">
                        <p class="property-label">حجم الملف</p>
                        <p>{{ document.file_size_display }}</p>
                    </div>
                    
                    <div class="mb-3">
                        <p class="property-label">الكلمات المفتاحية</p>
                        <div class="tags-container">
                            {% if document.tags_list %}
                                {% for tag in document.tags_list %}
                                <span class="badge bg-light text-dark">{{ tag }}</span>
                                {% endfor %}
                            {% else %}
                                <p class="text-muted">لا توجد كلمات مفتاحية</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- معلومات العلاقات -->
            <div class="card mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">العلاقات</h6>
                </div>
                <div class="card-body">
                    <p class="property-label">متعلق بـ</p>
                    <p>{{ document.get_related_to_display }}</p>
                    
                    {% if document.related_to == 'reservation' and document.reservation %}
                    <div class="relation-box">
                        <h6 class="font-weight-bold">معلومات الحجز</h6>
                        <p><strong>رقم الحجز:</strong> {{ document.reservation.reservation_number }}</p>
                        <p><strong>السيارة:</strong> {{ document.reservation.car }}</p>
                        <p><strong>العميل:</strong> {{ document.reservation.user.get_full_name|default:document.reservation.user.username }}</p>
                        <p><strong>الفترة:</strong> {{ document.reservation.start_date|date:"d/m/Y" }} إلى {{ document.reservation.end_date|date:"d/m/Y" }}</p>
                        <a href="{% url 'admin_reservation_detail' document.reservation.id %}" class="btn btn-sm btn-outline-primary mt-2">عرض تفاصيل الحجز</a>
                    </div>
                    {% endif %}
                    
                    {% if document.related_to == 'car' and document.car %}
                    <div class="relation-box">
                        <h6 class="font-weight-bold">معلومات السيارة</h6>
                        <p><strong>الطراز:</strong> {{ document.car.make }} {{ document.car.model }} {{ document.car.year }}</p>
                        <p><strong>رقم اللوحة:</strong> {{ document.car.license_plate }}</p>
                        <p><strong>الفئة:</strong> {{ document.car.get_category_display }}</p>
                        <a href="{% url 'admin_car_edit' document.car.id %}" class="btn btn-sm btn-outline-primary mt-2">عرض تفاصيل السيارة</a>
                    </div>
                    {% endif %}
                    
                    {% if document.related_to == 'user' and document.user %}
                    <div class="relation-box">
                        <h6 class="font-weight-bold">معلومات المستخدم</h6>
                        <p><strong>اسم المستخدم:</strong> {{ document.user.username }}</p>
                        <p><strong>الاسم الكامل:</strong> {{ document.user.get_full_name|default:"غير محدد" }}</p>
                        <p><strong>البريد الإلكتروني:</strong> {{ document.user.email|default:"غير محدد" }}</p>
                        <a href="{% url 'admin_user_detail' document.user.id %}" class="btn btn-sm btn-outline-primary mt-2">عرض تفاصيل المستخدم</a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-lg-8">
            <!-- عارض الملف -->
            <div class="card mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">الملف المرفق</h6>
                    <div>
                        <a href="{{ document.file.url }}" class="btn btn-sm btn-primary" download>
                            <i class="fas fa-download me-1"></i> تنزيل الملف
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    {% if document.is_image %}
                    <div class="file-preview">
                        <img src="{{ document.file.url }}" alt="{{ document.title }}">
                    </div>
                    {% elif document.is_pdf %}
                    <iframe src="{{ document.file.url }}" class="file-viewer"></iframe>
                    {% else %}
                    <div class="file-preview">
                        <div class="text-center">
                            <i class="far fa-file fa-6x text-muted mb-3"></i>
                            <h5>{{ document.file.name|slice:"25:" }}</h5>
                            <p class="text-muted">نوع الملف: {{ document.file_extension|upper }}</p>
                            <p class="text-muted">الحجم: {{ document.file_size_display }}</p>
                            <a href="{{ document.file.url }}" class="btn btn-primary mt-3" download>
                                <i class="fas fa-download me-1"></i> تنزيل الملف
                            </a>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
