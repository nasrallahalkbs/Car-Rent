{% extends 'layout_django.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% if is_english %}Secure Payment{% else %}بوابة الدفع الآمن{% endif %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/payment.css' %}">
<style>
/* International Payment Gateway Styles */
:root {
    --payment-primary: #2563eb;
    --payment-primary-dark: #1d4ed8;
    --payment-primary-light: #dbeafe;
    --payment-success: #10b981;
    --payment-warning: #f59e0b;
    --payment-danger: #ef4444;
    --payment-dark: #1f2937;
    --payment-gray: #6b7280;
    --payment-light: #f9fafb;
    --payment-border: #e5e7eb;
}

.int-payment-container {
    max-width: 1140px;
    margin: 0 auto;
    padding: 2rem 1rem;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
}

.int-payment-header {
    margin-bottom: 2rem;
    border-bottom: 1px solid var(--payment-border);
    padding-bottom: 1.5rem;
}

.int-payment-logo {
    display: flex;
    align-items: center;
    margin-bottom: 0.5rem;
}

.int-payment-logo-icon {
    width: 32px;
    height: 32px;
    margin-right: 0.75rem;
    color: var(--payment-primary);
}

.rtl .int-payment-logo-icon {
    margin-right: 0;
    margin-left: 0.75rem;
}

.int-payment-heading {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--payment-dark);
    margin: 0;
}

.int-payment-subheading {
    font-size: 0.875rem;
    color: var(--payment-gray);
    margin-top: 0.25rem;
}

.int-payment-security {
    display: flex;
    align-items: center;
    font-size: 0.75rem;
    color: var(--payment-gray);
    margin-top: 0.5rem;
}

.int-payment-security-icon {
    color: var(--payment-success);
    margin-right: 0.25rem;
}

.rtl .int-payment-security-icon {
    margin-right: 0;
    margin-left: 0.25rem;
}

.int-payment-progress {
    display: flex;
    justify-content: space-between;
    margin-bottom: 2rem;
    position: relative;
}

.int-payment-progress::before {
    content: '';
    position: absolute;
    top: 14px;
    left: 0;
    right: 0;
    height: 2px;
    background-color: var(--payment-border);
    z-index: 1;
}

.int-payment-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
    width: 25%;
}

.int-payment-step-marker {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background-color: var(--payment-light);
    border: 2px solid var(--payment-border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--payment-gray);
    position: relative;
}

.int-payment-step.active .int-payment-step-marker {
    background-color: var(--payment-primary);
    border-color: var(--payment-primary);
    color: white;
}

.int-payment-step.completed .int-payment-step-marker {
    background-color: var(--payment-success);
    border-color: var(--payment-success);
    color: white;
}

.int-payment-step.completed .int-payment-step-marker::after {
    content: '✓';
    position: absolute;
}

.int-payment-step.active::before, 
.int-payment-step.completed::before {
    content: '';
    position: absolute;
    top: 14px;
    left: -50%;
    width: 100%;
    height: 2px;
    background: var(--payment-primary);
    z-index: -1;
}

.int-payment-step:first-child.active::before, 
.int-payment-step:first-child.completed::before {
    display: none;
}

.int-payment-step.completed::before {
    background: var(--payment-success);
}

.int-payment-step-label {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--payment-gray);
    text-align: center;
    margin-top: 0.25rem;
}

.int-payment-step.active .int-payment-step-label {
    color: var(--payment-primary);
    font-weight: 600;
}

.int-payment-step.completed .int-payment-step-label {
    color: var(--payment-success);
    font-weight: 600;
}

.int-payment-layout {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
}

.int-payment-main {
    flex: 1;
    min-width: 0;
}

.int-payment-sidebar {
    width: 340px;
}

.int-payment-card {
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    margin-bottom: 1.5rem;
    border: 1px solid var(--payment-border);
}

.int-payment-card-header {
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--payment-border);
    background-color: var(--payment-light);
}

.int-payment-card-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--payment-dark);
    margin: 0;
}

.int-payment-card-body {
    padding: 1.25rem;
}

.int-payment-methods {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 0.75rem;
    margin-bottom: 1.5rem;
}

.int-payment-method {
    position: relative;
}

.int-payment-method input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
}

.int-payment-method-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1rem 0.75rem;
    border: 1px solid var(--payment-border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.15s ease;
    height: 100%;
}

.int-payment-method-label:hover {
    border-color: #cbd5e1;
    background-color: #f8fafc;
}

.int-payment-method input:checked + .int-payment-method-label {
    border-color: var(--payment-primary);
    background-color: rgba(37, 99, 235, 0.05);
}

.int-payment-method input:checked + .int-payment-method-label::after {
    content: '';
    position: absolute;
    top: -5px;
    right: -5px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background-color: var(--payment-primary);
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%23fff'%3E%3Cpath fill-rule='evenodd' d='M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z' clip-rule='evenodd'/%3E%3C/svg%3E");
    background-size: 12px;
    background-position: center;
    background-repeat: no-repeat;
    border: 2px solid white;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
}

.rtl .int-payment-method input:checked + .int-payment-method-label::after {
    right: auto;
    left: -5px;
}

.int-payment-method-icon {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 0.75rem;
}

.int-payment-method-icon img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

.int-payment-method-name {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--payment-dark);
    text-align: center;
}

.int-form-group {
    margin-bottom: 1.25rem;
}

.int-form-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--payment-dark);
    margin-bottom: 0.5rem;
}

.int-form-control {
    display: block;
    width: 100%;
    padding: 0.75rem 1rem;
    font-size: 0.875rem;
    line-height: 1.25;
    color: var(--payment-dark);
    background-color: white;
    border: 1px solid var(--payment-border);
    border-radius: 6px;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.int-form-control:focus {
    border-color: var(--payment-primary);
    outline: 0;
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

.int-form-row {
    display: flex;
    gap: 1rem;
}

.int-form-col {
    flex: 1;
    min-width: 0;
}

.int-form-col.small {
    flex: 0 0 80px;
}

.int-card-input {
    font-family: monospace;
    letter-spacing: 0.5px;
}

.int-card-badge {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    height: 24px;
}

.rtl .int-card-badge {
    right: auto;
    left: 1rem;
}

.int-form-control-wrapper {
    position: relative;
}

.int-card-preview {
    background: linear-gradient(135deg, #1e40af, #2563eb);
    border-radius: 12px;
    padding: 1.5rem;
    color: white;
    margin-bottom: 1.5rem;
    position: relative;
    height: 200px;
    box-shadow: 0 10px 25px -5px rgba(37, 99, 235, 0.5);
    overflow: hidden;
}

.int-card-preview::before {
    content: '';
    position: absolute;
    top: -50px;
    right: -40px;
    width: 150px;
    height: 150px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
}

.int-card-preview::after {
    content: '';
    position: absolute;
    bottom: -80px;
    left: -30px;
    width: 180px;
    height: 180px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 50%;
}

.int-card-chip {
    width: 40px;
    height: 30px;
    background: linear-gradient(135deg, #f7df94, #daa520);
    border-radius: 5px;
    position: relative;
    margin-bottom: 1.5rem;
}

.int-card-chip::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 25px;
    height: 15px;
    background: rgba(0, 0, 0, 0.1);
    border-radius: 3px;
}

.int-card-number {
    font-size: 1.25rem;
    font-family: monospace;
    letter-spacing: 2px;
    margin-bottom: 1.5rem;
    position: relative;
    z-index: 1;
}

.int-card-holder {
    position: relative;
    z-index: 1;
    margin-bottom: 0.5rem;
}

.int-card-label {
    font-size: 0.625rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    opacity: 0.8;
    margin-bottom: 0.25rem;
}

.int-card-value {
    font-size: 0.875rem;
    letter-spacing: 1px;
}

.int-card-exp {
    display: flex;
    margin-top: 0.75rem;
}

.int-card-logo {
    position: absolute;
    bottom: 1.5rem;
    right: 1.5rem;
    height: 30px;
    z-index: 2;
}

.rtl .int-card-logo {
    right: auto;
    left: 1.5rem;
}

.int-summary-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--payment-border);
}

.int-summary-item:last-child {
    border-bottom: none;
}

.int-summary-label {
    font-size: 0.875rem;
    color: var(--payment-gray);
}

.int-summary-value {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--payment-dark);
}

.int-summary-total {
    display: flex;
    justify-content: space-between;
    padding-top: 0.75rem;
    margin-top: 0.5rem;
    border-top: 2px solid var(--payment-border);
}

.int-summary-total-label {
    font-size: 1rem;
    font-weight: 600;
    color: var(--payment-dark);
}

.int-summary-total-value {
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--payment-primary);
}

.int-car-detail {
    display: flex;
    padding: 1rem;
    background-color: var(--payment-light);
    border-radius: 8px;
    margin-bottom: 1.5rem;
}

.int-car-image {
    width: 80px;
    height: 80px;
    border-radius: 6px;
    object-fit: cover;
    margin-right: 1rem;
    flex-shrink: 0;
}

.rtl .int-car-image {
    margin-right: 0;
    margin-left: 1rem;
}

.int-car-info {
    flex: 1;
    min-width: 0;
}

.int-car-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--payment-dark);
    margin-bottom: 0.25rem;
}

.int-car-subtitle {
    font-size: 0.75rem;
    color: var(--payment-gray);
    margin-bottom: 0.5rem;
}

.int-car-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-top: 0.5rem;
}

.int-car-meta-item {
    font-size: 0.75rem;
    color: var(--payment-gray);
    display: flex;
    align-items: center;
}

.int-car-meta-item i {
    font-size: 0.875rem;
    color: var(--payment-primary);
    margin-right: 0.25rem;
}

.rtl .int-car-meta-item i {
    margin-right: 0;
    margin-left: 0.25rem;
}

.int-btn {
    display: inline-block;
    font-weight: 500;
    text-align: center;
    vertical-align: middle;
    cursor: pointer;
    user-select: none;
    padding: 0.75rem 1.5rem;
    font-size: 0.875rem;
    line-height: 1.25;
    border-radius: 6px;
    transition: all 0.15s ease-in-out;
    border: 1px solid transparent;
}

.int-btn:focus {
    outline: 0;
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.25);
}

.int-btn-primary {
    color: white;
    background-color: var(--payment-primary);
    border-color: var(--payment-primary);
}

.int-btn-primary:hover {
    background-color: var(--payment-primary-dark);
    border-color: var(--payment-primary-dark);
}

.int-btn-lg {
    padding: 0.875rem 1.75rem;
    font-size: 1rem;
    line-height: 1.5;
    border-radius: 0.5rem;
}

.int-btn-block {
    display: block;
    width: 100%;
}

.int-badge {
    display: inline-block;
    padding: 0.35em 0.65em;
    font-size: 0.75em;
    font-weight: 500;
    line-height: 1;
    text-align: center;
    white-space: nowrap;
    vertical-align: baseline;
    border-radius: 50rem;
}

.int-badge-success {
    color: #0d9488;
    background-color: #d1fae5;
}

.int-badge-warning {
    color: #b45309;
    background-color: #fef3c7;
}

.int-badge-primary {
    color: #1d4ed8;
    background-color: #dbeafe;
}

.int-text-danger {
    color: var(--payment-danger);
}

.int-form-check {
    display: flex;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.int-form-check-input {
    margin-right: 0.5rem;
    margin-top: 0.25rem;
    flex-shrink: 0;
}

.rtl .int-form-check-input {
    margin-right: 0;
    margin-left: 0.5rem;
}

.int-form-check-label {
    font-size: 0.875rem;
    color: var(--payment-gray);
}

.int-security-badges {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 1.5rem;
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--payment-border);
}

.int-security-badge {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.int-security-badge-icon {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background-color: var(--payment-light);
    margin-bottom: 0.5rem;
}

.int-security-badge-icon i {
    font-size: 1.25rem;
    color: var(--payment-success);
}

.int-security-badge-text {
    font-size: 0.75rem;
    color: var(--payment-gray);
    max-width: 110px;
}

.int-method-form {
    display: none;
}

.int-method-form.active {
    display: block;
    animation: fadeInUp 0.3s ease forwards;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Responsive styles */
@media (max-width: 991px) {
    .int-payment-layout {
        flex-direction: column;
    }
    
    .int-payment-sidebar {
        width: 100%;
        order: -1;
    }
}

@media (max-width: 767px) {
    .int-payment-methods {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .int-form-row {
        flex-direction: column;
        gap: 1rem;
    }
    
    .int-form-col.small {
        flex: 1;
    }
    
    .int-payment-step-label {
        display: none;
    }
}

/* RTL support */
.rtl .int-payment-progress::before {
    left: 0;
    right: 0;
}

.rtl .int-payment-step.active::before, 
.rtl .int-payment-step.completed::before {
    left: auto;
    right: -50%;
}
</style>
{% endblock %}

{% block content %}
<div class="int-payment-container">
    <!-- Payment Header -->
    <div class="int-payment-header">
        <div class="int-payment-logo">
            <div class="int-payment-logo-icon">
                <i class="fas fa-shield-alt fa-2x"></i>
            </div>
            <div>
                <h1 class="int-payment-heading">{% if is_english %}Secure Payment{% else %}بوابة الدفع الآمن{% endif %}</h1>
                <p class="int-payment-subheading">{% if is_english %}Complete your reservation with secure payment{% else %}أكمل عملية الدفع بأمان لتأكيد حجزك{% endif %}</p>
                <div class="int-payment-security">
                    <i class="fas fa-lock int-payment-security-icon"></i>
                    <span>{% if is_english %}Secure connection with 256-bit SSL encryption{% else %}اتصال آمن مع تشفير SSL بطول 256 بت{% endif %}</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Progress Steps -->
    <div class="int-payment-progress">
        <div class="int-payment-step completed">
            <div class="int-payment-step-marker">1</div>
            <div class="int-payment-step-label">{% if is_english %}Car Selection{% else %}اختيار السيارة{% endif %}</div>
        </div>
        <div class="int-payment-step completed">
            <div class="int-payment-step-marker">2</div>
            <div class="int-payment-step-label">{% if is_english %}Booking Details{% else %}تفاصيل الحجز{% endif %}</div>
        </div>
        <div class="int-payment-step active">
            <div class="int-payment-step-marker">3</div>
            <div class="int-payment-step-label">{% if is_english %}Payment{% else %}الدفع{% endif %}</div>
        </div>
        <div class="int-payment-step">
            <div class="int-payment-step-marker">4</div>
            <div class="int-payment-step-label">{% if is_english %}Confirmation{% else %}التأكيد{% endif %}</div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="int-payment-layout">
        <!-- Main Column -->
        <div class="int-payment-main">
            <form method="post" action="{% url 'professional_payment' %}{% if not from_cart %}?reservation_id={{ reservation.id }}{% endif %}" id="payment-form">
                {% csrf_token %}
                
                <!-- Payment Methods Card -->
                <div class="int-payment-card">
                    <div class="int-payment-card-header">
                        <h3 class="int-payment-card-title">{% if is_english %}Select Payment Method{% else %}اختر طريقة الدفع{% endif %}</h3>
                    </div>
                    <div class="int-payment-card-body">
                        <div class="int-payment-methods">
                            <div class="int-payment-method">
                                <input type="radio" name="payment_method" id="credit_card" value="credit_card" checked>
                                <label for="credit_card" class="int-payment-method-label">
                                    <div class="int-payment-method-icon">
                                        <img src="{% static 'images/credit_card.svg' %}" alt="Credit Card">
                                    </div>
                                    <div class="int-payment-method-name">{% if is_english %}Credit Card{% else %}بطاقة ائتمان{% endif %}</div>
                                </label>
                            </div>
                            
                            <div class="int-payment-method">
                                <input type="radio" name="payment_method" id="visa" value="visa">
                                <label for="visa" class="int-payment-method-label">
                                    <div class="int-payment-method-icon">
                                        <img src="{% static 'images/visa.svg' %}" alt="Visa">
                                    </div>
                                    <div class="int-payment-method-name">Visa</div>
                                </label>
                            </div>
                            
                            <div class="int-payment-method">
                                <input type="radio" name="payment_method" id="mastercard" value="mastercard">
                                <label for="mastercard" class="int-payment-method-label">
                                    <div class="int-payment-method-icon">
                                        <img src="{% static 'images/mastercard.svg' %}" alt="Mastercard">
                                    </div>
                                    <div class="int-payment-method-name">Mastercard</div>
                                </label>
                            </div>
                            
                            <div class="int-payment-method">
                                <input type="radio" name="payment_method" id="paypal" value="paypal">
                                <label for="paypal" class="int-payment-method-label">
                                    <div class="int-payment-method-icon">
                                        <img src="{% static 'images/paypal.svg' %}" alt="PayPal">
                                    </div>
                                    <div class="int-payment-method-name">PayPal</div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Card Payment Form -->
                        <div id="credit_card-form" class="int-method-form active">
                            <!-- Card Preview -->
                            <div class="int-card-preview">
                                <div class="int-card-chip"></div>
                                <div class="int-card-number">•••• •••• •••• ••••</div>
                                <div class="int-card-holder">
                                    <div class="int-card-label">{% if is_english %}Card Holder{% else %}حامل البطاقة{% endif %}</div>
                                    <div class="int-card-value">{% if is_english %}YOUR NAME{% else %}اسمك{% endif %}</div>
                                </div>
                                <div class="int-card-exp">
                                    <div style="margin-right: 1.5rem" class="{% if is_rtl %}ms-3{% else %}me-3{% endif %}">
                                        <div class="int-card-label">{% if is_english %}Expires{% else %}تاريخ الانتهاء{% endif %}</div>
                                        <div class="int-card-value">MM/YY</div>
                                    </div>
                                    <div>
                                        <div class="int-card-label">CVV</div>
                                        <div class="int-card-value">•••</div>
                                    </div>
                                </div>
                                <img src="{% static 'images/visa.svg' %}" alt="Card" class="int-card-logo">
                            </div>
                            
                            <!-- Card Input Fields -->
                            <div class="int-form-group">
                                <label for="card_number" class="int-form-label">{% if is_english %}Card Number{% else %}رقم البطاقة{% endif %}</label>
                                <div class="int-form-control-wrapper">
                                    <input type="text" class="int-form-control int-card-input" id="card_number" placeholder="•••• •••• •••• ••••" autocomplete="cc-number">
                                    <img src="{% static 'images/card_brands.svg' %}" alt="Card Brands" class="int-card-badge">
                                </div>
                            </div>
                            
                            <div class="int-form-group">
                                <label for="card_name" class="int-form-label">{% if is_english %}Cardholder Name{% else %}اسم حامل البطاقة{% endif %}</label>
                                <input type="text" class="int-form-control" id="card_name" placeholder="{% if is_english %}Full name as displayed on card{% else %}الاسم الكامل كما هو مكتوب على البطاقة{% endif %}" autocomplete="cc-name">
                            </div>
                            
                            <div class="int-form-row">
                                <div class="int-form-col">
                                    <div class="int-form-group">
                                        <label for="expiry_date" class="int-form-label">{% if is_english %}Expiry Date{% else %}تاريخ الانتهاء{% endif %}</label>
                                        <input type="text" class="int-form-control" id="expiry_date" placeholder="MM / YY" autocomplete="cc-exp">
                                    </div>
                                </div>
                                <div class="int-form-col small">
                                    <div class="int-form-group">
                                        <label for="cvv" class="int-form-label">CVV</label>
                                        <input type="text" class="int-form-control" id="cvv" placeholder="•••" autocomplete="cc-csc">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="int-form-check">
                                <input class="int-form-check-input" type="checkbox" id="save_card" checked>
                                <label class="int-form-check-label" for="save_card">
                                    {% if is_english %}Save this card for future bookings{% else %}حفظ هذه البطاقة للحجوزات المستقبلية{% endif %}
                                </label>
                            </div>
                        </div>
                        
                        <!-- PayPal Form -->
                        <div id="paypal-form" class="int-method-form">
                            <div class="text-center py-4">
                                <img src="{% static 'images/paypal_large.svg' %}" alt="PayPal" style="height: 60px; margin-bottom: 1rem;">
                                <p class="mb-0" style="color: var(--payment-gray);">
                                    {% if is_english %}
                                    You will be redirected to PayPal to complete your payment securely
                                    {% else %}
                                    سيتم توجيهك إلى PayPal لإتمام الدفع بشكل آمن
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                        
                        <!-- Visa Form -->
                        <div id="visa-form" class="int-method-form">
                            <!-- Same as credit card form but branded as Visa -->
                            <div class="text-center py-2 mb-4">
                                <img src="{% static 'images/visa_large.svg' %}" alt="Visa" style="height: 40px;">
                            </div>
                            
                            <!-- Card Input Fields -->
                            <div class="int-form-group">
                                <label for="visa_number" class="int-form-label">{% if is_english %}Visa Card Number{% else %}رقم بطاقة Visa{% endif %}</label>
                                <input type="text" class="int-form-control int-card-input" id="visa_number" placeholder="4•••  ••••  ••••  ••••" autocomplete="cc-number">
                            </div>
                            
                            <div class="int-form-group">
                                <label for="visa_name" class="int-form-label">{% if is_english %}Cardholder Name{% else %}اسم حامل البطاقة{% endif %}</label>
                                <input type="text" class="int-form-control" id="visa_name" placeholder="{% if is_english %}Full name as displayed on card{% else %}الاسم الكامل كما هو مكتوب على البطاقة{% endif %}" autocomplete="cc-name">
                            </div>
                            
                            <div class="int-form-row">
                                <div class="int-form-col">
                                    <div class="int-form-group">
                                        <label for="visa_expiry" class="int-form-label">{% if is_english %}Expiry Date{% else %}تاريخ الانتهاء{% endif %}</label>
                                        <input type="text" class="int-form-control" id="visa_expiry" placeholder="MM / YY" autocomplete="cc-exp">
                                    </div>
                                </div>
                                <div class="int-form-col small">
                                    <div class="int-form-group">
                                        <label for="visa_cvv" class="int-form-label">CVV</label>
                                        <input type="text" class="int-form-control" id="visa_cvv" placeholder="•••" autocomplete="cc-csc">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Mastercard Form -->
                        <div id="mastercard-form" class="int-method-form">
                            <!-- Same as credit card form but branded as Mastercard -->
                            <div class="text-center py-2 mb-4">
                                <img src="{% static 'images/mastercard_large.svg' %}" alt="Mastercard" style="height: 40px;">
                            </div>
                            
                            <!-- Card Input Fields -->
                            <div class="int-form-group">
                                <label for="mc_number" class="int-form-label">{% if is_english %}Mastercard Number{% else %}رقم بطاقة Mastercard{% endif %}</label>
                                <input type="text" class="int-form-control int-card-input" id="mc_number" placeholder="5•••  ••••  ••••  ••••" autocomplete="cc-number">
                            </div>
                            
                            <div class="int-form-group">
                                <label for="mc_name" class="int-form-label">{% if is_english %}Cardholder Name{% else %}اسم حامل البطاقة{% endif %}</label>
                                <input type="text" class="int-form-control" id="mc_name" placeholder="{% if is_english %}Full name as displayed on card{% else %}الاسم الكامل كما هو مكتوب على البطاقة{% endif %}" autocomplete="cc-name">
                            </div>
                            
                            <div class="int-form-row">
                                <div class="int-form-col">
                                    <div class="int-form-group">
                                        <label for="mc_expiry" class="int-form-label">{% if is_english %}Expiry Date{% else %}تاريخ الانتهاء{% endif %}</label>
                                        <input type="text" class="int-form-control" id="mc_expiry" placeholder="MM / YY" autocomplete="cc-exp">
                                    </div>
                                </div>
                                <div class="int-form-col small">
                                    <div class="int-form-group">
                                        <label for="mc_cvv" class="int-form-label">CVV</label>
                                        <input type="text" class="int-form-control" id="mc_cvv" placeholder="•••" autocomplete="cc-csc">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Billing Information -->
                <div class="int-payment-card">
                    <div class="int-payment-card-header">
                        <h3 class="int-payment-card-title">{% if is_english %}Billing Information{% else %}معلومات الفواتير{% endif %}</h3>
                    </div>
                    <div class="int-payment-card-body">
                        <div class="int-form-row">
                            <div class="int-form-col">
                                <div class="int-form-group">
                                    <label for="first_name" class="int-form-label">{% if is_english %}First Name{% else %}الاسم الأول{% endif %}</label>
                                    <input type="text" class="int-form-control" id="first_name" value="{{ request.user.first_name }}">
                                </div>
                            </div>
                            <div class="int-form-col">
                                <div class="int-form-group">
                                    <label for="last_name" class="int-form-label">{% if is_english %}Last Name{% else %}اسم العائلة{% endif %}</label>
                                    <input type="text" class="int-form-control" id="last_name" value="{{ request.user.last_name }}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="int-form-group">
                            <label for="email" class="int-form-label">{% if is_english %}Email Address{% else %}البريد الإلكتروني{% endif %}</label>
                            <input type="email" class="int-form-control" id="email" value="{{ request.user.email }}">
                        </div>
                        
                        <div class="int-form-check">
                            <input class="int-form-check-input" type="checkbox" id="terms_agree" checked required>
                            <label class="int-form-check-label" for="terms_agree">
                                {% if is_english %}
                                I agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms and Conditions</a> and <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy</a>
                                {% else %}
                                أوافق على <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">الشروط والأحكام</a> و <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">سياسة الخصوصية</a>
                                {% endif %}
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Submit Button with Messages -->
                <div class="mb-4">
                    <div class="alert alert-warning" role="alert">
                        <i class="fas fa-exclamation-triangle {% if is_rtl %}ms-2{% else %}me-2{% endif %}"></i>
                        {% if is_english %}
                        <strong>Important:</strong> This payment will be processed after your reservation has been confirmed by an administrator. You won't be charged until then.
                        {% else %}
                        <strong>هام:</strong> ستتم معالجة هذا الدفع بعد أن يتم تأكيد حجزك من قبل المسؤول. لن يتم خصم المبلغ حتى ذلك الحين.
                        {% endif %}
                    </div>
                    
                    <button type="submit" class="int-btn int-btn-primary int-btn-lg int-btn-block">
                        {% if is_english %}Complete Payment{% else %}إكمال الدفع{% endif %}
                    </button>
                    
                    <div class="int-security-badges">
                        <div class="int-security-badge">
                            <div class="int-security-badge-icon">
                                <i class="fas fa-lock"></i>
                            </div>
                            <div class="int-security-badge-text">
                                {% if is_english %}Secure Payment{% else %}دفع آمن{% endif %}
                            </div>
                        </div>
                        <div class="int-security-badge">
                            <div class="int-security-badge-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="int-security-badge-text">
                                {% if is_english %}Data Protection{% else %}حماية البيانات{% endif %}
                            </div>
                        </div>
                        <div class="int-security-badge">
                            <div class="int-security-badge-icon">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <div class="int-security-badge-text">
                                {% if is_english %}Encrypted Transaction{% else %}معاملة مشفرة{% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Sidebar -->
        <div class="int-payment-sidebar">
            <!-- Order Summary -->
            <div class="int-payment-card">
                <div class="int-payment-card-header">
                    <h3 class="int-payment-card-title">{% if is_english %}Order Summary{% else %}ملخص الطلب{% endif %}</h3>
                </div>
                <div class="int-payment-card-body">
                    {% if reservation %}
                    <!-- Single Reservation Summary -->
                    <div class="int-car-detail">
                        {% if reservation.car.image %}
                            <img src="{{ reservation.car.image.url }}" alt="{{ reservation.car.make }} {{ reservation.car.model }}" class="int-car-image">
                        {% elif reservation.car.image_url %}
                            <img src="{{ reservation.car.image_url }}" alt="{{ reservation.car.make }} {{ reservation.car.model }}" class="int-car-image">
                        {% else %}
                            <img src="{% static 'img/car-placeholder.svg' %}" alt="{{ reservation.car.make }} {{ reservation.car.model }}" class="int-car-image">
                        {% endif %}
                        <div class="int-car-info">
                            <div class="int-car-title">{{ reservation.car.make }} {{ reservation.car.model }}</div>
                            <div class="int-car-subtitle">{{ reservation.car.year }} | {{ reservation.car.category }}</div>
                            <div class="int-car-meta">
                                <div class="int-car-meta-item">
                                    <i class="fas fa-calendar"></i>
                                    {% if is_english %}
                                    {{ reservation.days }} days
                                    {% else %}
                                    {{ reservation.days }} أيام
                                    {% endif %}
                                </div>
                                <div class="int-car-meta-item">
                                    <i class="fas fa-gas-pump"></i>
                                    {{ reservation.car.fuel_type }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="int-summary-item">
                        <div class="int-summary-label">{% if is_english %}Daily Rate{% else %}السعر اليومي{% endif %}</div>
                        <div class="int-summary-value">{% if is_english %}${{ reservation.car.daily_rate }}{% else %}{{ reservation.car.daily_rate }} دينار{% endif %}</div>
                    </div>
                    
                    <div class="int-summary-item">
                        <div class="int-summary-label">{% if is_english %}Duration{% else %}المدة{% endif %}</div>
                        <div class="int-summary-value">{% if is_english %}{{ reservation.days }} days{% else %}{{ reservation.days }} أيام{% endif %}</div>
                    </div>
                    
                    <div class="int-summary-item">
                        <div class="int-summary-label">{% if is_english %}Pick-up Date{% else %}تاريخ الاستلام{% endif %}</div>
                        <div class="int-summary-value">{% if is_english %}{{ reservation.start_date|date:"M d, Y" }}{% else %}{{ reservation.start_date|date:"d M Y" }}{% endif %}</div>
                    </div>
                    
                    <div class="int-summary-item">
                        <div class="int-summary-label">{% if is_english %}Return Date{% else %}تاريخ الإرجاع{% endif %}</div>
                        <div class="int-summary-value">{% if is_english %}{{ reservation.end_date|date:"M d, Y" }}{% else %}{{ reservation.end_date|date:"d M Y" }}{% endif %}</div>
                    </div>
                    
                    {% else %}
                    <!-- Cart Items Summary -->
                    {% for item in cart_items %}
                    <div class="int-car-detail {% if not forloop.first %}mt-3{% endif %}">
                        {% if item.car.image %}
                            <img src="{{ item.car.image.url }}" alt="{{ item.car.make }} {{ item.car.model }}" class="int-car-image">
                        {% elif item.car.image_url %}
                            <img src="{{ item.car.image_url }}" alt="{{ item.car.make }} {{ item.car.model }}" class="int-car-image">
                        {% else %}
                            <img src="{% static 'img/car-placeholder.svg' %}" alt="{{ item.car.make }} {{ item.car.model }}" class="int-car-image">
                        {% endif %}
                        <div class="int-car-info">
                            <div class="int-car-title">{{ item.car.make }} {{ item.car.model }}</div>
                            <div class="int-car-subtitle">{{ item.car.year }} | {{ item.car.category }}</div>
                            <div class="int-car-meta">
                                <div class="int-car-meta-item">
                                    <i class="fas fa-calendar"></i>
                                    {% if is_english %}
                                    {{ item.days }} days
                                    {% else %}
                                    {{ item.days }} أيام
                                    {% endif %}
                                </div>
                                <div class="int-car-meta-item">
                                    <i class="fas fa-gas-pump"></i>
                                    {{ item.car.fuel_type }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="int-summary-item">
                        <div class="int-summary-label">{{ item.car.make }} {{ item.car.model }}</div>
                        <div class="int-summary-value">{% if is_english %}${{ item.total }}{% else %}{{ item.total }} دينار{% endif %}</div>
                    </div>
                    {% endfor %}
                    
                    <div class="int-summary-item">
                        <div class="int-summary-label">{% if is_english %}Total Days{% else %}إجمالي الأيام{% endif %}</div>
                        <div class="int-summary-value">{% if is_english %}{{ total_days }} days{% else %}{{ total_days }} أيام{% endif %}</div>
                    </div>
                    {% endif %}
                    
                    <!-- Total -->
                    <div class="int-summary-total">
                        <div class="int-summary-total-label">{% if is_english %}Total Amount{% else %}المبلغ الإجمالي{% endif %}</div>
                        <div class="int-summary-total-value">{% if is_english %}${{ total_amount }}{% else %}{{ total_amount }} دينار{% endif %}</div>
                    </div>
                    
                    <div class="mt-3 text-center">
                        <span class="int-badge int-badge-success">
                            <i class="fas fa-check-circle {% if is_rtl %}ms-1{% else %}me-1{% endif %}"></i>
                            {% if is_english %}Best Price Guarantee{% else %}ضمان أفضل سعر{% endif %}
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Help & Support -->
            <div class="int-payment-card">
                <div class="int-payment-card-header">
                    <h3 class="int-payment-card-title">{% if is_english %}Help & Support{% else %}المساعدة والدعم{% endif %}</h3>
                </div>
                <div class="int-payment-card-body">
                    <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                        <i class="fas fa-phone-alt {% if is_rtl %}ms-3{% else %}me-3{% endif %}" style="color: var(--payment-primary); font-size: 1.25rem;"></i>
                        <div>
                            <div style="font-size: 0.75rem; color: var(--payment-gray);">{% if is_english %}Phone Support{% else %}الدعم الهاتفي{% endif %}</div>
                            <div style="font-weight: 600;">+1 (800) 123-4567</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: center; margin-bottom: 0.75rem;">
                        <i class="fas fa-envelope {% if is_rtl %}ms-3{% else %}me-3{% endif %}" style="color: var(--payment-primary); font-size: 1.25rem;"></i>
                        <div>
                            <div style="font-size: 0.75rem; color: var(--payment-gray);">{% if is_english %}Email Support{% else %}دعم البريد الإلكتروني{% endif %}</div>
                            <div style="font-weight: 600;">support@carrental.com</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; align-items: center;">
                        <i class="fas fa-comments {% if is_rtl %}ms-3{% else %}me-3{% endif %}" style="color: var(--payment-primary); font-size: 1.25rem;"></i>
                        <div>
                            <div style="font-size: 0.75rem; color: var(--payment-gray);">{% if is_english %}Live Chat{% else %}المحادثة المباشرة{% endif %}</div>
                            <div style="font-weight: 600; color: var(--payment-success);">{% if is_english %}Online - Chat Now{% else %}متصل - تحدث الآن{% endif %}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Payment method selection
        const paymentMethods = document.querySelectorAll('input[name="payment_method"]');
        const paymentForms = document.querySelectorAll('.int-method-form');
        
        function showSelectedPaymentForm() {
            const selectedMethod = document.querySelector('input[name="payment_method"]:checked').value;
            
            // Hide all forms
            paymentForms.forEach(form => {
                form.classList.remove('active');
            });
            
            // Show the selected form
            const selectedForm = document.getElementById(`${selectedMethod}-form`);
            if (selectedForm) {
                selectedForm.classList.add('active');
            }
        }
        
        // Initialize
        showSelectedPaymentForm();
        
        // Add event listeners to payment method radios
        paymentMethods.forEach(method => {
            method.addEventListener('change', showSelectedPaymentForm);
        });
        
        // Credit card number formatting
        const cardNumberInputs = document.querySelectorAll('.int-card-input');
        cardNumberInputs.forEach(input => {
            input.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                let formattedValue = '';
                
                for (let i = 0; i < value.length; i++) {
                    if (i > 0 && i % 4 === 0) {
                        formattedValue += ' ';
                    }
                    formattedValue += value[i];
                }
                
                e.target.value = formattedValue;
            });
        });
        
        // Expiry date formatting
        const expiryInputs = document.querySelectorAll('#expiry_date, #visa_expiry, #mc_expiry');
        expiryInputs.forEach(input => {
            input.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                
                if (value.length > 2) {
                    value = value.substring(0, 2) + ' / ' + value.substring(2, 4);
                }
                
                e.target.value = value;
            });
        });
        
        // CVV input restriction
        const cvvInputs = document.querySelectorAll('#cvv, #visa_cvv, #mc_cvv');
        cvvInputs.forEach(input => {
            input.addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/\D/g, '').substring(0, 3);
            });
        });
        
        // Form submission
        const form = document.getElementById('payment-form');
        form.addEventListener('submit', function(e) {
            // For the demo, we're submitting the form normally to process the reservation
            // In a real implementation, we'd validate all fields and potentially use a payment gateway API
            
            // This would be something like:
            // e.preventDefault();
            // validateForm();
            // processPayment();
            
            // But for our demo, we'll just submit the form to the server
        });
        
        // Simple validation function (not used in demo)
        function validateForm() {
            let isValid = true;
            const selectedMethod = document.querySelector('input[name="payment_method"]:checked').value;
            
            // Add validation logic here
            
            return isValid;
        }
    });
</script>
{% endblock %}