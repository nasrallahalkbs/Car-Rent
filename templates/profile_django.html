
{% extends 'layout_django.html' %}
{% load i18n %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}
  {% if is_english %}
    User Profile - Car Rental
  {% else %}
    الملف الشخصي - تأجير السيارات
  {% endif %}
{% endblock %}

{% block extra_css %}
<style>
  /* ألوان الثيم والمتغيرات */
  :root {
    --primary-color: #3a86ff;
    --primary-dark: #2970d6;
    --primary-light: #c7dbff;
    --accent-color: #ff006e;
    --accent-light: #ffcce0;
    --success-color: #38b000;
    --warning-color: #ffbe0b;
    --danger-color: #ff595e;
    --dark-color: #2b3a55;
    --text-color: #212529;
    --text-muted: #6c757d;
    --light-bg: #f8f9fa;
    --card-shadow: 0 10px 20px rgba(0,0,0,0.08);
    --hover-shadow: 0 15px 30px rgba(58, 134, 255, 0.2);
    --border-radius-lg: 15px;
    --border-radius-md: 10px;
    --transition-normal: all 0.3s ease;
  }

  /* تصميم متقدم للتاب نافيجيشن */
  .profile-tabs {
    border-bottom: none;
    margin-bottom: 30px;
    display: flex;
    justify-content: center;
  }

  .profile-tabs .nav-item {
    margin: 0 10px;
  }

  .profile-tabs .nav-link {
    border: none;
    padding: 12px 20px;
    border-radius: var(--border-radius-md);
    font-weight: 600;
    color: var(--text-muted);
    background-color: white;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    transition: var(--transition-normal);
    position: relative;
    overflow: hidden;
    z-index: 1;
  }

  .profile-tabs .nav-link::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(to right, var(--primary-color), #4dabf7);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.3s ease;
    z-index: -1;
  }

  .profile-tabs .nav-link:hover::before,
  .profile-tabs .nav-link.active::before {
    transform: scaleX(1);
  }

  .profile-tabs .nav-link:hover {
    color: var(--primary-color);
    transform: translateY(-3px);
  }

  .profile-tabs .nav-link.active {
    color: var(--primary-color);
    background-color: white;
    box-shadow: 0 8px 15px rgba(58, 134, 255, 0.15);
    transform: translateY(-3px);
  }

  .profile-tabs .nav-link i {
    margin-right: 8px;
  }

  /* إطار الملف الشخصي */
  .profile-wrapper {
    background: linear-gradient(135deg, var(--light-bg) 0%, #e9ecef 100%);
    border-radius: var(--border-radius-lg);
    padding: 30px;
    box-shadow: var(--card-shadow);
    position: relative;
    overflow: hidden;
    margin-bottom: 40px;
  }

  .profile-wrapper::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: linear-gradient(to right, var(--primary-color), #4dabf7);
    z-index: 1;
  }

  .profile-wrapper::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%233a86ff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    z-index: 0;
    opacity: 0.3;
  }

  /* تحسين بطاقة الملف الشخصي */
  .profile-card {
    background: white;
    border-radius: var(--border-radius-md);
    box-shadow: var(--card-shadow);
    transition: var(--transition-normal);
    position: relative;
    z-index: 1;
    border: none;
    overflow: hidden;
    height: 100%;
  }

  .profile-card:hover {
    box-shadow: var(--hover-shadow);
    transform: translateY(-5px);
  }

  .profile-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, #4dabf7 100%);
    padding: 25px 20px;
    text-align: center;
    position: relative;
    overflow: hidden;
    border-radius: 10px 10px 0 0;
  }

  .profile-header-pattern {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
    opacity: 0.3;
    z-index: 0;
  }

  .profile-avatar {
    width: 120px;
    height: 120px;
    background: white;
    border-radius: 50%;
    margin: 0 auto 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    position: relative;
    z-index: 1;
    border: 4px solid rgba(255,255,255,0.2);
  }

  .profile-avatar i {
    font-size: 3.5rem;
    color: var(--primary-color);
  }

  .profile-info {
    padding: 30px 20px;
    text-align: center;
  }

  .profile-name {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--dark-color);
    margin-bottom: 10px;
  }

  .profile-meta {
    color: var(--text-muted);
    font-size: 0.95rem;
    display: inline-flex;
    align-items: center;
    margin-bottom: 20px;
  }

  .profile-meta i {
    margin-right: 6px;
    color: var(--primary-color);
  }

  .profile-stats {
    display: flex;
    justify-content: center;
    margin: 25px 0;
    gap: 20px;
  }

  .profile-stat {
    text-align: center;
    background-color: var(--light-bg);
    border-radius: var(--border-radius-md);
    padding: 15px;
    flex: 1;
    transition: var(--transition-normal);
    box-shadow: 0 5px 10px rgba(0,0,0,0.03);
  }

  .profile-stat:hover {
    background-color: white;
    box-shadow: 0 8px 15px rgba(0,0,0,0.08);
    transform: translateY(-3px);
  }

  .profile-stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 5px;
  }

  .profile-stat-label {
    font-size: 0.8rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .profile-links {
    display: flex;
    gap: 10px;
    margin-top: 20px;
  }

  .profile-link-btn {
    flex: 1;
    padding: 12px 15px;
    border-radius: var(--border-radius-md);
    font-weight: 600;
    text-align: center;
    transition: var(--transition-normal);
    text-decoration: none;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .profile-link-btn i {
    margin-right: 8px;
  }

  .profile-link-btn.primary {
    background-color: var(--primary-color);
    color: white;
  }

  .profile-link-btn.primary:hover {
    background-color: var(--primary-dark);
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(58, 134, 255, 0.3);
  }

  .profile-link-btn.secondary {
    background-color: white;
    color: var(--accent-color);
    border: 1px solid var(--accent-light);
  }

  .profile-link-btn.secondary:hover {
    background-color: var(--accent-light);
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(255, 0, 110, 0.1);
  }

  /* تحسين بطاقة المعلومات الشخصية */
  .info-card {
    background: white;
    border-radius: var(--border-radius-md);
    box-shadow: var(--card-shadow);
    transition: var(--transition-normal);
    position: relative;
    border: none;
    overflow: hidden;
    margin-bottom: 30px;
  }

  .info-card:hover {
    box-shadow: var(--hover-shadow);
  }

  .info-card-header {
    background-color: white;
    border-bottom: 1px solid rgba(0,0,0,0.05);
    padding: 18px 25px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .info-card-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--dark-color);
    margin: 0;
    display: flex;
    align-items: center;
  }

  .info-card-title i {
    margin-right: 10px;
    color: var(--primary-color);
    font-size: 1.4rem;
  }

  .info-card-body {
    padding: 25px;
  }

  /* تحسين نموذج الملف الشخصي */
  .profile-form .form-label {
    font-weight: 600;
    color: var(--dark-color);
    margin-bottom: 8px;
  }

  .profile-form .form-control {
    border-radius: var(--border-radius-md);
    padding: 12px 15px;
    border: 1px solid #ced4da;
    font-size: 1rem;
    transition: var(--transition-normal);
  }

  .profile-form .form-control:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.25rem rgba(58, 134, 255, 0.25);
  }

  .profile-form .form-control:hover {
    border-color: #adb5bd;
  }

  .profile-form .form-control[readonly] {
    background-color: #f8f9fa;
    border-color: #e9ecef;
  }

  .profile-form .submit-btn {
    background: linear-gradient(135deg, var(--primary-color) 0%, #4dabf7 100%);
    color: white;
    border: none;
    border-radius: var(--border-radius-md);
    padding: 12px 25px;
    font-weight: 600;
    transition: var(--transition-normal);
    box-shadow: 0 5px 15px rgba(58, 134, 255, 0.3);
    position: relative;
    overflow: hidden;
    width: 100%;
  }

  .profile-form .submit-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(to right, transparent, rgba(255,255,255,0.2), transparent);
    transition: all 0.5s ease;
  }

  .profile-form .submit-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(58, 134, 255, 0.4);
  }

  .profile-form .submit-btn:hover::before {
    left: 100%;
  }

  /* تحسين عرض الحجوزات الأخيرة */
  .reservations-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }

  .reservations-table th {
    font-weight: 600;
    background-color: var(--light-bg);
    color: var(--dark-color);
    padding: 14px 20px;
    text-align: start;
    border-bottom: 1px solid #e9ecef;
  }

  .reservations-table td {
    padding: 14px 20px;
    color: var(--text-color);
    border-bottom: 1px solid #e9ecef;
    vertical-align: middle;
  }

  .reservations-table tr:last-child td {
    border-bottom: none;
  }

  .reservations-table tr {
    transition: var(--transition-normal);
  }

  .reservations-table tr:hover {
    background-color: #f8f9fa;
  }

  .car-name {
    font-weight: 600;
    color: var(--dark-color);
    display: flex;
    align-items: center;
  }

  .car-name i {
    margin-right: 8px;
    color: var(--primary-color);
  }

  .reservation-status {
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
  }

  .status-pending {
    background-color: #fff8dd;
    color: #cc8800;
  }

  .status-confirmed {
    background-color: #dff2ff;
    color: #0066cc;
  }

  .status-completed {
    background-color: #e3f8e5;
    color: #008800;
  }

  .status-cancelled {
    background-color: #ffe5e5;
    color: #cc0000;
  }

  .reservation-status i {
    margin-right: 5px;
  }

  .action-btn {
    background-color: white;
    border: 1px solid var(--primary-color);
    color: var(--primary-color);
    border-radius: var(--border-radius-md);
    padding: 7px 15px;
    font-size: 0.85rem;
    font-weight: 600;
    transition: var(--transition-normal);
    display: inline-flex;
    align-items: center;
    text-decoration: none;
  }

  .action-btn:hover {
    background-color: var(--primary-color);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(58, 134, 255, 0.2);
  }

  .action-btn i {
    margin-right: 5px;
  }

  .empty-reservations {
    text-align: center;
    padding: 40px 20px;
  }

  .empty-reservations i {
    font-size: 4rem;
    color: #e9ecef;
    margin-bottom: 20px;
    display: block;
  }

  .empty-reservations h4 {
    color: var(--dark-color);
    font-weight: 600;
    margin-bottom: 10px;
  }

  .empty-reservations p {
    color: var(--text-muted);
    margin-bottom: 20px;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }

  .browse-btn {
    background: linear-gradient(135deg, var(--primary-color) 0%, #4dabf7 100%);
    color: white;
    border: none;
    border-radius: 30px;
    padding: 10px 25px;
    font-weight: 600;
    transition: var(--transition-normal);
    box-shadow: 0 5px 15px rgba(58, 134, 255, 0.3);
    display: inline-flex;
    align-items: center;
    text-decoration: none;
  }

  .browse-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(58, 134, 255, 0.4);
    color: white;
  }

  .browse-btn i {
    margin-right: 8px;
  }

  /* التحسينات للنسخة العربية (RTL) */
  .rtl-margin-fix {
    margin-right: 0 !important;
    margin-left: 8px !important;
  }

  /* تحسينات متحركة */
  .animate-fade-in {
    animation: fadeIn 0.5s ease-in-out forwards;
  }

  .animate-slide-up {
    animation: slideUp 0.5s ease-in-out forwards;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* تصميم متجاوب */
  @media (max-width: 992px) {
    .profile-wrapper {
      padding: 20px;
    }
    
    .profile-tabs .nav-item {
      margin: 0 5px;
    }
    
    .profile-tabs .nav-link {
      padding: 10px 15px;
      font-size: 0.9rem;
    }
    
    .profile-card {
      margin-bottom: 30px;
    }
  }

  @media (max-width: 768px) {
    .profile-tabs {
      flex-wrap: wrap;
    }
    
    .profile-tabs .nav-item {
      margin: 5px;
      flex: 1 1 calc(50% - 10px);
    }
    
    .profile-avatar {
      width: 100px;
      height: 100px;
    }
    
    .profile-name {
      font-size: 1.3rem;
    }
    
    .profile-stats {
      flex-direction: column;
      gap: 10px;
    }
    
    .reservations-table {
      display: block;
      overflow-x: auto;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-5 animate-fade-in">
  <!-- عنوان الصفحة -->
  <div class="profile-wrapper">
    <div class="row">
      <div class="col-12 text-center">
        <h2 class="mb-4 fw-bold">
          {% if is_english %}
            <i class="fas fa-user-circle {% if is_rtl %}ms-2{% else %}me-2{% endif %}"></i> User Dashboard
          {% else %}
            <i class="fas fa-user-circle {% if is_rtl %}ms-2{% else %}me-2{% endif %}"></i> لوحة المستخدم
          {% endif %}
        </h2>
        <p class="text-muted">
          {% if is_english %}
            Manage your account, view your reservations and favorite cars
          {% else %}
            إدارة حسابك، عرض حجوزاتك والسيارات المفضلة لديك
          {% endif %}
        </p>
      </div>
    </div>
  </div>

  <!-- أقسام الصفحة -->
  <ul class="nav nav-pills profile-tabs animate-slide-up" id="profileTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="true">
        <i class="fas fa-user {% if is_rtl %}rtl-margin-fix{% endif %}"></i>
        {% if is_english %}Profile{% else %}الملف الشخصي{% endif %}
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="edit-tab" data-bs-toggle="tab" data-bs-target="#edit-tab-pane" type="button" role="tab" aria-controls="edit-tab-pane" aria-selected="false">
        <i class="fas fa-user-edit {% if is_rtl %}rtl-margin-fix{% endif %}"></i>
        {% if is_english %}Edit Profile{% else %}تعديل الملف{% endif %}
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="reservations-tab" data-bs-toggle="tab" data-bs-target="#reservations-tab-pane" type="button" role="tab" aria-controls="reservations-tab-pane" aria-selected="false">
        <i class="fas fa-calendar-check {% if is_rtl %}rtl-margin-fix{% endif %}"></i>
        {% if is_english %}Reservations{% else %}الحجوزات{% endif %}
      </button>
    </li>
  </ul>

  <div class="tab-content" id="profileTabContent">
    <!-- قسم عرض الملف الشخصي -->
    <div class="tab-pane fade show active animate-fade-in" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
      <div class="row">
        <div class="col-lg-4">
          <div class="profile-card">
            <div class="profile-header">
              <div class="profile-header-pattern"></div>
              <div class="profile-avatar">
                <i class="fas fa-user"></i>
              </div>
            </div>

            <div class="profile-info">
              <h3 class="profile-name">{{ user.get_full_name|default:user.username }}</h3>
              <div class="profile-meta">
                <i class="fas fa-calendar-alt {% if is_rtl %}rtl-margin-fix{% endif %}"></i>
                {% if is_english %}
                  Member since {{ user.date_joined|date:"F d, Y" }}
                {% else %}
                  عضو منذ {{ user.date_joined|date:"Y/m/d" }}
                {% endif %}
              </div>

              <div class="profile-stats">
                <div class="profile-stat">
                  <div class="profile-stat-value">{{ reservations.count }}</div>
                  <div class="profile-stat-label">
                    {% if is_english %}
                      Reservations
                    {% else %}
                      الحجوزات
                    {% endif %}
                  </div>
                </div>
                
                <div class="profile-stat">
                  <div class="profile-stat-value">
                    {% for res in reservations %}
                      {% if res.status == 'completed' %}
                        {% with total_completed=forloop.counter %}
                          {{ total_completed }}
                        {% endwith %}
                      {% else %}
                        0
                      {% endif %}
                    {% empty %}
                      0
                    {% endfor %}
                  </div>
                  <div class="profile-stat-label">
                    {% if is_english %}
                      Completed
                    {% else %}
                      مكتملة
                    {% endif %}
                  </div>
                </div>
              </div>

              <div class="profile-links">
                <a href="{% url 'my_reservations' %}" class="profile-link-btn primary">
                  <i class="fas fa-list {% if is_rtl %}rtl-margin-fix{% endif %}"></i>
                  {% if is_english %}Reservations{% else %}حجوزاتي{% endif %}
                </a>
                <a href="{% url 'favorite_cars' %}" class="profile-link-btn secondary">
                  <i class="fas fa-heart {% if is_rtl %}rtl-margin-fix{% endif %}"></i>
                  {% if is_english %}Favorites{% else %}المفضلة{% endif %}
                </a>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-8">
          <div class="info-card">
            <div class="info-card-header">
              <h3 class="info-card-title">
                <i class="fas fa-id-card {% if is_rtl %}rtl-margin-fix{% endif %}"></i>
                {% if is_english %}
                  Personal Information
                {% else %}
                  المعلومات الشخصية
                {% endif %}
              </h3>
            </div>
            <div class="info-card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label text-muted small text-uppercase">
                      {% if is_english %}Username{% else %}اسم المستخدم{% endif %}
                    </label>
                    <p class="mb-0 fw-bold">{{ user.username }}</p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label text-muted small text-uppercase">
                      {% if is_english %}Email{% else %}البريد الإلكتروني{% endif %}
                    </label>
                    <p class="mb-0 fw-bold">{{ user.email }}</p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label text-muted small text-uppercase">
                      {% if is_english %}First Name{% else %}الاسم الأول{% endif %}
                    </label>
                    <p class="mb-0 fw-bold">{{ user.first_name|default:"—" }}</p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label text-muted small text-uppercase">
                      {% if is_english %}Last Name{% else %}اسم العائلة{% endif %}
                    </label>
                    <p class="mb-0 fw-bold">{{ user.last_name|default:"—" }}</p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label text-muted small text-uppercase">
                      {% if is_english %}Phone Number{% else %}رقم الهاتف{% endif %}
                    </label>
                    <p class="mb-0 fw-bold">{{ user.phone|default:"—" }}</p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label text-muted small text-uppercase">
                      {% if is_english %}Date Joined{% else %}تاريخ التسجيل{% endif %}
                    </label>
                    <p class="mb-0 fw-bold">
                      {% if is_english %}
                        {{ user.date_joined|date:"F d, Y" }}
                      {% else %}
                        {{ user.date_joined|date:"Y/m/d" }}
                      {% endif %}
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="info-card">
            <div class="info-card-header">
              <h3 class="info-card-title">
                <i class="fas fa-bell {% if is_rtl %}rtl-margin-fix{% endif %}"></i>
                {% if is_english %}
                  Activity Summary
                {% else %}
                  ملخص النشاط
                {% endif %}
              </h3>
            </div>
            <div class="info-card-body">
              <div class="row g-4">
                <div class="col-md-4">
                  <div class="text-center">
                    <div class="mb-3">
                      <i class="fas fa-car-alt fa-2x text-primary"></i>
                    </div>
                    <h4 class="h5 fw-bold">
                      {% if is_english %}
                        Active Bookings
                      {% else %}
                        الحجوزات النشطة
                      {% endif %}
                    </h4>
                    <h2 class="display-4 fw-bold text-primary">
                      {% for res in reservations %}
                        {% if res.status == 'confirmed' %}
                          {% with total_active=forloop.counter %}
                            {{ total_active }}
                          {% endwith %}
                        {% else %}
                          0
                        {% endif %}
                      {% empty %}
                        0
                      {% endfor %}
                    </h2>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="text-center">
                    <div class="mb-3">
                      <i class="fas fa-clock fa-2x text-warning"></i>
                    </div>
                    <h4 class="h5 fw-bold">
                      {% if is_english %}
                        Pending Payments
                      {% else %}
                        مدفوعات معلقة
                      {% endif %}
                    </h4>
                    <h2 class="display-4 fw-bold text-warning">
                      {% for res in reservations %}
                        {% if res.payment_status == 'pending' %}
                          {% with total_pending=forloop.counter %}
                            {{ total_pending }}
                          {% endwith %}
                        {% else %}
                          0
                        {% endif %}
                      {% empty %}
                        0
                      {% endfor %}
                    </h2>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="text-center">
                    <div class="mb-3">
                      <i class="fas fa-heart fa-2x text-danger"></i>
                    </div>
                    <h4 class="h5 fw-bold">
                      {% if is_english %}
                        Favorite Cars
                      {% else %}
                        السيارات المفضلة
                      {% endif %}
                    </h4>
                    <h2 class="display-4 fw-bold text-danger">
                      <!-- عدد السيارات المفضلة - يجب تنفيذه -->
                      0
                    </h2>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- قسم تعديل الملف الشخصي -->
    <div class="tab-pane fade animate-fade-in" id="edit-tab-pane" role="tabpanel" aria-labelledby="edit-tab" tabindex="0">
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <div class="info-card">
            <div class="info-card-header">
              <h3 class="info-card-title">
                <i class="fas fa-user-edit {% if is_rtl %}rtl-margin-fix{% endif %}"></i>
                {% if is_english %}
                  Edit Profile Information
                {% else %}
                  تعديل معلومات الملف الشخصي
                {% endif %}
              </h3>
            </div>
            <div class="info-card-body">
              <form method="post" class="profile-form">
                {% csrf_token %}
                <div class="mb-4">
                  <label for="id_username" class="form-label">
                    {% if is_english %}Username{% else %}اسم المستخدم{% endif %}
                  </label>
                  <input type="text" name="username" value="{{ user.username }}" class="form-control" id="id_username" readonly>
                  <div class="form-text text-muted">
                    {% if is_english %}
                      Username cannot be changed.
                    {% else %}
                      لا يمكن تغيير اسم المستخدم.
                    {% endif %}
                  </div>
                </div>
                
                <div class="row mb-4">
                  <div class="col-md-6">
                    <label for="id_first_name" class="form-label">
                      {% if is_english %}First Name{% else %}الاسم الأول{% endif %}
                    </label>
                    <input type="text" name="first_name" value="{{ user.first_name }}" class="form-control" id="id_first_name">
                  </div>
                  <div class="col-md-6">
                    <label for="id_last_name" class="form-label">
                      {% if is_english %}Last Name{% else %}اسم العائلة{% endif %}
                    </label>
                    <input type="text" name="last_name" value="{{ user.last_name }}" class="form-control" id="id_last_name">
                  </div>
                </div>
                
                <div class="mb-4">
                  <label for="id_email" class="form-label">
                    {% if is_english %}Email{% else %}البريد الإلكتروني{% endif %}
                  </label>
                  <input type="email" name="email" value="{{ user.email }}" class="form-control" id="id_email">
                </div>
                
                <div class="mb-4">
                  <label for="id_phone" class="form-label">
                    {% if is_english %}Phone Number{% else %}رقم الهاتف{% endif %}
                  </label>
                  <input type="text" name="phone" value="{{ user.phone }}" class="form-control" id="id_phone">
                </div>
                
                <div class="d-grid mt-4">
                  <button type="submit" class="submit-btn">
                    <i class="fas fa-save {% if is_rtl %}rtl-margin-fix{% endif %}"></i>
                    {% if is_english %}Save Changes{% else %}حفظ التغييرات{% endif %}
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- قسم الحجوزات -->
    <div class="tab-pane fade animate-fade-in" id="reservations-tab-pane" role="tabpanel" aria-labelledby="reservations-tab" tabindex="0">
      <div class="row">
        <div class="col-12">
          <div class="info-card">
            <div class="info-card-header">
              <h3 class="info-card-title">
                <i class="fas fa-calendar-check {% if is_rtl %}rtl-margin-fix{% endif %}"></i>
                {% if is_english %}
                  Recent Reservations
                {% else %}
                  آخر الحجوزات
                {% endif %}
              </h3>
            </div>
            <div class="info-card-body">
              {% if reservations %}
                <div class="table-responsive">
                  <table class="reservations-table">
                    <thead>
                      <tr>
                        <th>
                          {% if is_english %}Car{% else %}السيارة{% endif %}
                        </th>
                        <th>
                          {% if is_english %}Dates{% else %}التواريخ{% endif %}
                        </th>
                        <th>
                          {% if is_english %}Status{% else %}الحالة{% endif %}
                        </th>
                        <th>
                          {% if is_english %}Payment{% else %}الدفع{% endif %}
                        </th>
                        <th>
                          {% if is_english %}Actions{% else %}الإجراءات{% endif %}
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for reservation in reservations %}
                      <tr>
                        <td>
                          <div class="car-name">
                            <i class="fas fa-car"></i> {{ reservation.car.make }} {{ reservation.car.model }} ({{ reservation.car.year }})
                          </div>
                        </td>
                        <td>
                          {% if is_english %}
                            {{ reservation.start_date|date:"M d, Y" }} - {{ reservation.end_date|date:"M d, Y" }}
                          {% else %}
                            {{ reservation.start_date|date:"Y/m/d" }} - {{ reservation.end_date|date:"Y/m/d" }}
                          {% endif %}
                        </td>
                        <td>
                          {% if reservation.status == 'pending' %}
                            <span class="reservation-status status-pending">
                              <i class="fas fa-clock"></i>
                              {% if is_english %}Pending{% else %}قيد الانتظار{% endif %}
                            </span>
                          {% elif reservation.status == 'confirmed' %}
                            <span class="reservation-status status-confirmed">
                              <i class="fas fa-check-circle"></i>
                              {% if is_english %}Confirmed{% else %}مؤكد{% endif %}
                            </span>
                          {% elif reservation.status == 'completed' %}
                            <span class="reservation-status status-completed">
                              <i class="fas fa-check-double"></i>
                              {% if is_english %}Completed{% else %}مكتمل{% endif %}
                            </span>
                          {% elif reservation.status == 'cancelled' %}
                            <span class="reservation-status status-cancelled">
                              <i class="fas fa-times-circle"></i>
                              {% if is_english %}Cancelled{% else %}ملغي{% endif %}
                            </span>
                          {% endif %}
                        </td>
                        <td>
                          {% if reservation.payment_status == 'pending' %}
                            <span class="reservation-status status-pending">
                              <i class="fas fa-clock"></i>
                              {% if is_english %}Pending{% else %}معلق{% endif %}
                            </span>
                          {% elif reservation.payment_status == 'paid' %}
                            <span class="reservation-status status-completed">
                              <i class="fas fa-check-circle"></i>
                              {% if is_english %}Paid{% else %}مدفوع{% endif %}
                            </span>
                          {% elif reservation.payment_status == 'refunded' %}
                            <span class="reservation-status status-cancelled">
                              <i class="fas fa-undo"></i>
                              {% if is_english %}Refunded{% else %}مسترد{% endif %}
                            </span>
                          {% endif %}
                        </td>
                        <td>
                          <a href="{% url 'reservation_detail' reservation_id=reservation.id %}" class="action-btn">
                            <i class="fas fa-eye {% if is_rtl %}rtl-margin-fix{% endif %}"></i>
                            {% if is_english %}View Details{% else %}عرض التفاصيل{% endif %}
                          </a>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
                <div class="text-center mt-4">
                  <a href="{% url 'my_reservations' %}" class="browse-btn">
                    <i class="fas fa-list {% if is_rtl %}rtl-margin-fix{% endif %}"></i>
                    {% if is_english %}View All Reservations{% else %}عرض جميع الحجوزات{% endif %}
                  </a>
                </div>
              {% else %}
                <div class="empty-reservations">
                  <i class="fas fa-calendar-times"></i>
                  <h4>
                    {% if is_english %}
                      No Reservations Yet
                    {% else %}
                      لا توجد حجوزات حتى الآن
                    {% endif %}
                  </h4>
                  <p>
                    {% if is_english %}
                      You haven't made any car reservations yet. Browse our collection to find your perfect ride.
                    {% else %}
                      لم تقم بإجراء أي حجوزات سيارات حتى الآن. تصفح مجموعتنا للعثور على سيارتك المثالية.
                    {% endif %}
                  </p>
                  <a href="{% url 'cars' %}" class="browse-btn">
                    <i class="fas fa-car {% if is_rtl %}rtl-margin-fix{% endif %}"></i>
                    {% if is_english %}Browse Cars{% else %}تصفح السيارات{% endif %}
                  </a>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // تفعيل التاب المناسب عند تحميل الصفحة
  document.addEventListener('DOMContentLoaded', function() {
    // التحقق من وجود تاب محدد في الرابط
    const urlParams = new URLSearchParams(window.location.search);
    const tabParam = urlParams.get('tab');
    
    if (tabParam) {
      const tab = document.querySelector(`#${tabParam}-tab`);
      if (tab) {
        const bsTab = new bootstrap.Tab(tab);
        bsTab.show();
      }
    }
    
    // تأثير للعناصر المتحركة
    const animateElements = document.querySelectorAll('.animate-fade-in, .animate-slide-up');
    animateElements.forEach((el, index) => {
      el.style.opacity = '0';
      setTimeout(() => {
        el.style.removeProperty('opacity');
      }, index * 100);
    });
  });
</script>
{% endblock %}
